<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>百度地图GIS</title>

<link href="https://www.zybuluo.com/static/img/favicon.png" type="image/x-icon" rel="icon">

<link href="https://www.zybuluo.com/static/assets/9b84e41b.base.lib.min.css" rel="stylesheet" media="screen">

<link href="https://www.zybuluo.com/static/font-awesome/css/font-awesome.css" rel="stylesheet">


<!-- id="prettify-style" will be used to get the link element below and change href to change prettify code style, so it can't be in beginmin/endmin block. -->
<link id="prettify-style" href="https://www.zybuluo.com/static/editor/libs/google-code-prettify/prettify-cmd.css" type="text/css" rel="stylesheet">
<link href="https://www.zybuluo.com/static/assets/mdeditor/8eb06c40.layout.min.css" rel="stylesheet" media="screen">

</head>
<body>
<div class="md-section-divider"></div>

<div class="md-section-divider"></div>

<h1 id="百度地图gis">百度地图GIS</h1>

<p><code>GIS</code> <code>AIMap</code> <code>地图</code></p>

<hr>

<p><div class="toc">
<ul>
<li><a href="#百度地图gis">百度地图GIS</a><ul>
<li><a href="#技术摘要gis平台第三方接入文档">技术摘要：GIS平台第三方接入文档</a></li>
<li><a href="#概述">概述</a><ul>
<li><a href="#功能说明">功能说明</a></li>
<li><a href="#使用说明">使用说明</a></li>
</ul>
</li>
<li><a href="#1标点前台">1、标点前台</a><ul>
<li><a href="#功能说明-1">功能说明</a></li>
<li><a href="#核心代码">核心代码</a></li>
</ul>
</li>
<li><a href="#2标点信息显示">2、标点信息显示</a><ul>
<li><a href="#功能说明-2">功能说明</a></li>
<li><a href="#核心代码-1">核心代码</a></li>
</ul>
</li>
<li><a href="#3显示简单多边形区域">3、显示简单多边形区域</a><ul>
<li><a href="#功能说明-3">功能说明</a></li>
<li><a href="#核心代码-2">核心代码</a></li>
</ul>
</li>
<li><a href="#4显示多个多边形区域">4、显示多个多边形区域</a><ul>
<li><a href="#功能说明-4">功能说明</a></li>
<li><a href="#核心代码-3">核心代码</a></li>
</ul>
</li>
<li><a href="#5单个区域绘制">5、单个区域绘制</a><ul>
<li><a href="#功能说明-5">功能说明</a></li>
<li><a href="#核心代码-4">核心代码</a></li>
</ul>
</li>
<li><a href="#6检验父区域绘制">6、检验父区域绘制</a><ul>
<li><a href="#功能说明-6">功能说明</a></li>
<li><a href="#核心代码-5">核心代码</a></li>
</ul>
</li>
<li><a href="#7按id数组显示节点">7、按ID数组显示节点</a><ul>
<li><a href="#功能说明-7">功能说明</a></li>
<li><a href="#核心代码-6">核心代码</a></li>
</ul>
</li>
<li><a href="#8显示行政区域">8、显示行政区域</a><ul>
<li><a href="#功能说明-8">功能说明</a></li>
<li><a href="#核心代码-7">核心代码</a></li>
</ul>
</li>
<li><a href="#9计算两点间距离">9、计算两点间距离</a><ul>
<li><a href="#功能说明-9">功能说明</a></li>
<li><a href="#核心代码-8">核心代码</a></li>
</ul>
</li>
<li><a href="#10导航">10、导航</a><ul>
<li><a href="#功能说明-10">功能说明</a></li>
<li><a href="#核心代码-9">核心代码</a></li>
</ul>
</li>
<li><a href="#11周边搜索">11、周边搜索</a><ul>
<li><a href="#功能说明-11">功能说明</a></li>
<li><a href="#核心代码-10">核心代码</a></li>
</ul>
</li>
<li><a href="#12自定义信息窗口">12、自定义信息窗口</a><ul>
<li><a href="#功能说明-12">功能说明</a></li>
<li><a href="#核心代码-11">核心代码</a></li>
</ul>
</li>
<li><a href="#13根据应用显示树">13、根据应用显示树</a><ul>
<li><a href="#功能说明-13">功能说明</a></li>
<li><a href="#核心代码-12">核心代码</a></li>
</ul>
</li>
<li><a href="#14ajax">14、Ajax</a><ul>
<li><a href="#功能说明-14">功能说明</a></li>
<li><a href="#核心代码-13">核心代码</a></li>
</ul>
</li>
<li><a href="#15其他方法">15、其他方法</a></li>
</ul>
</li>
</ul>
</div>
</p>

<div class="md-section-divider"></div>

<h2 id="技术摘要gis平台第三方接入文档">技术摘要：GIS平台第三方接入文档</h2>

<div class="md-section-divider"></div>

<h2 id="概述">概述</h2>

<div class="md-section-divider"></div>

<h3 id="功能说明">功能说明</h3>

<ul>
<li>系统允许第三方系统通过引用GIS平台的三个JS文件，一个地图脚本文件，两个base64转码脚本（必要时需要引入一些百度自带样式文件和脚本文件，或者jquery、jquery.ztree.js），来实现以下功能。</li>
</ul>

<div class="md-section-divider"></div>

<h3 id="使用说明">使用说明</h3>

<ul>
<li>第一步，页面引入文件：</li>
</ul>

<div class="md-section-divider"></div>

<pre class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code class="language-`javascript"><span class="tag">&lt;script</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"text/javascript"</span><span class="pln"> </span><span class="atn">src</span><span class="pun">=</span><span class="atv">"XXX/crypto-js/3.1.2-4/core-min.js"</span><span class="tag">&gt;&lt;/script&gt;</span></code></li><li class="L1"><code class="language-`javascript"><span class="tag">&lt;script</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"text/javascript"</span><span class="pln"> </span><span class="atn">src</span><span class="pun">=</span><span class="atv">"XXX/crypto-js/3.1.2-4/enc-base64-min.js"</span><span class="tag">&gt;&lt;/script&gt;</span></code></li><li class="L2"><code class="language-`javascript"><span class="tag">&lt;script</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"text/javascript"</span><span class="pln"> </span><span class="atn">src</span><span class="pun">=</span><span class="atv">"XXX/AIMap/1.0.0/AIMap.js"</span><span class="tag">&gt;&lt;/script&gt;</span></code></li></ol></pre>

<ul>
<li>第二步，body添加初始化方法，并定义地图容器div：</li>
</ul>

<div class="md-section-divider"></div>

<pre class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code class="language-`javascript"><span class="com">&lt;!--注意：AIMap_loadScript()方法中传入值：1，表示加载高德地图--&gt;</span></code></li><li class="L1"><code class="language-`javascript"><span class="tag">&lt;body</span><span class="pln"> </span><span class="atn">onload</span><span class="pun">=</span><span class="atv">"</span><span class="typ">AIMap_loadScript</span><span class="pun">()</span><span class="atv">"</span><span class="tag">&gt;</span></code></li><li class="L2"><code class="language-`javascript"><span class="pln">    </span><span class="com">&lt;!--注意：必须为myMap定义好宽高，否则地图不显示--&gt;</span></code></li><li class="L3"><code class="language-`javascript"><span class="pln">    </span><span class="tag">&lt;div</span><span class="pln"> </span><span class="atn">id</span><span class="pun">=</span><span class="atv">"myMap"</span><span class="tag">&gt;&lt;/div&gt;</span></code></li><li class="L4"><code class="language-`javascript"><span class="tag">&lt;/body&gt;</span></code></li></ol></pre>

<ul>
<li>第三步，script脚本中添加方法用于当地图脚本加载完成后异步加载百度地图工具类： <br>
<ul><li>情景1：不使用百度地图绘制功能、不使用api自带标记点信息弹窗样式</li></ul></li>
</ul>

<div class="md-section-divider"></div>

<pre class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code><span class="com">//加载完成地图脚本</span></code></li><li class="L1"><code><span class="kwd">function</span><span class="pln"> </span><span class="typ">AIMap_encapsulateBMap</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L2"><code><span class="pln">    </span><span class="typ">AIMap_loadTools</span><span class="pun">();</span><span class="com">//直接调用该方法</span></code></li><li class="L3"><code><span class="pun">}</span></code></li></ol></pre>

<ul>
<li> <br>
<ul><li>情景2：不使用百度地图绘制功能、使用api自带标记点信息弹窗样式</li></ul></li>
</ul>

<div class="md-section-divider"></div>

<pre class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code><span class="com">//加载完成地图脚本</span></code></li><li class="L1"><code><span class="kwd">function</span><span class="pln"> </span><span class="typ">AIMap_encapsulateBMap</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L2"><code><span class="pln">    </span><span class="com">//加载信息框脚本</span></code></li><li class="L3"><code><span class="pln">    </span><span class="com">//需要引入样式文件：&lt;link rel="stylesheet" href="http://api.map.baidu.com/library/SearchInfoWindow/1.5/src/SearchInfoWindow_min.css" /&gt;</span></code></li><li class="L4"><code><span class="pln">    </span><span class="com">//完成后直接调用AIMap_loadTools方法</span></code></li><li class="L5"><code><span class="pln">    </span><span class="typ">AIMap_asysScript</span><span class="pun">(</span><span class="str">"http://api.map.baidu.com/library/SearchInfoWindow/1.5/src/SearchInfoWindow_min.js"</span><span class="pun">,</span><span class="typ">AIMap_loadTools</span><span class="pun">);</span></code></li><li class="L6"><code><span class="pun">}</span></code></li></ol></pre>

<ul>
<li> <br>
<ul><li>情景3：使用百度地图绘制功能、使用api自带标记点信息弹窗样式</li></ul></li>
</ul>

<div class="md-section-divider"></div>

<pre class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code class="language-`javascript"><span class="com">//加载完成地图脚本</span></code></li><li class="L1"><code class="language-`javascript"><span class="kwd">function</span><span class="pln"> </span><span class="typ">AIMap_encapsulateBMap</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L2"><code class="language-`javascript"><span class="pln">    </span><span class="com">//加载鼠标绘制工具条库（百度）--画区域需要用到</span></code></li><li class="L3"><code class="language-`javascript"><span class="pln">    </span><span class="com">//同时需要引入样式文件：&lt;link rel="stylesheet" href="http://api.map.baidu.com/library/SearchInfoWindow/1.5/src/SearchInfoWindow_min.css" /&gt;</span></code></li><li class="L4"><code class="language-`javascript"><span class="pln">    </span><span class="typ">AIMap_asysScript</span><span class="pun">(</span><span class="str">"http://api.map.baidu.com/library/DrawingManager/1.4/src/DrawingManager.js"</span><span class="pun">,</span><span class="pln">loadInfoWin</span><span class="pun">);</span></code></li><li class="L5"><code class="language-`javascript"><span class="pun">}</span></code></li><li class="L6"><code class="language-`javascript"></code></li><li class="L7"><code class="language-`javascript"><span class="com">//加载弹窗js</span></code></li><li class="L8"><code class="language-`javascript"><span class="kwd">function</span><span class="pln"> loadInfoWin</span><span class="pun">(){</span></code></li><li class="L9"><code class="language-`javascript"><span class="pln">    </span><span class="typ">AIMapLib</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="typ">BMapLib</span><span class="pun">;</span><span class="com">//这一步可省，将BMapLib赋值给AIMapLib</span></code></li><li class="L0"><code class="language-`javascript"><span class="pln">    </span><span class="com">//同时需要引入样式文件：&lt;link rel="stylesheet" href="http://api.map.baidu.com/library/DrawingManager/1.4/src/DrawingManager_min.css" /&gt;</span></code></li><li class="L1"><code class="language-`javascript"><span class="pln">    </span><span class="typ">AIMap_asysScript</span><span class="pun">(</span><span class="str">"http://api.map.baidu.com/library/SearchInfoWindow/1.5/src/SearchInfoWindow_min.js"</span><span class="pun">,</span><span class="pln">loadSearch</span><span class="pun">);</span></code></li><li class="L2"><code class="language-`javascript"><span class="pun">}</span></code></li><li class="L3"><code class="language-`javascript"></code></li><li class="L4"><code class="language-`javascript"><span class="kwd">function</span><span class="pln"> loadSearch</span><span class="pun">(){</span></code></li><li class="L5"><code class="language-`javascript"><span class="pln">    </span><span class="com">//最后一个异步加载的回调方法必须为AIMap_loadTools</span></code></li><li class="L6"><code class="language-`javascript"><span class="pln">    </span><span class="com">//加载点与多边形关系工具库（百度）--比较点是否在区域内需要用到</span></code></li><li class="L7"><code class="language-`javascript"><span class="pln">    </span><span class="typ">AIMap_asysScript</span><span class="pun">(</span><span class="str">"http://api.map.baidu.com/library/GeoUtils/1.2/src/GeoUtils.js"</span><span class="pun">,</span><span class="typ">AIMap_loadTools</span><span class="pun">);</span></code></li><li class="L8"><code class="language-`javascript"><span class="pun">}</span></code></li></ol></pre>

<ul>
<li>第四步，完成地图初始化，添加方法AIMap：</li>
</ul>

<div class="md-section-divider"></div>

<pre class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code class="language-`javascript"><span class="kwd">function</span><span class="pln"> </span><span class="typ">AIMap_init</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L1"><code class="language-`javascript"><span class="pln">    myMap </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">AIMap</span><span class="pun">.</span><span class="typ">Map</span><span class="pun">(</span><span class="str">"myMap"</span><span class="pun">);</span></code></li><li class="L2"><code class="language-`javascript"><span class="pln">    myMap</span><span class="pun">.</span><span class="pln">centerAndZoom</span><span class="pun">(</span><span class="str">'杭州'</span><span class="pun">,</span><span class="pln"> </span><span class="lit">13</span><span class="pun">);</span></code></li><li class="L3"><code class="language-`javascript"><span class="pln">    myMap</span><span class="pun">.</span><span class="pln">enableScrollWheelZoom</span><span class="pun">();</span></code></li><li class="L4"><code class="language-`javascript"><span class="pln">    myMap</span><span class="pun">.</span><span class="pln">addControl</span><span class="pun">(</span><span class="kwd">new</span><span class="pln"> </span><span class="typ">AIMap</span><span class="pun">.</span><span class="typ">NavigationControl</span><span class="pun">());</span><span class="pln"> </span><span class="com">//添加默认缩放平移控件</span></code></li><li class="L5"><code class="language-`javascript"><span class="pln">    myMap</span><span class="pun">.</span><span class="pln">onload </span><span class="pun">=</span><span class="pln"> mapLoadCallback</span><span class="pun">;</span></code></li><li class="L6"><code class="language-`javascript"><span class="pun">}</span></code></li></ol></pre>

<ul>
<li>第五步，添加方法mapLoadCallback，开始自己的代码：</li>
</ul>

<div class="md-section-divider"></div>

<pre class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code class="language-`javascript"><span class="kwd">function</span><span class="pln"> mapLoadCallback</span><span class="pun">(){</span></code></li><li class="L1"><code class="language-`javascript"><span class="pln">    </span><span class="com">//第三方自己的代码</span></code></li><li class="L2"><code class="language-`javascript"><span class="pun">}</span></code></li></ol></pre>

<div class="md-section-divider"></div>

<h2 id="1标点前台">1、标点前台</h2>

<div class="md-section-divider"></div>

<h3 id="功能说明-1">功能说明</h3>

<ul>
<li>点击地图，将会返回鼠标点击处的百度坐标，并在此处添加标记点进行展示</li>
</ul>

<div class="md-section-divider"></div>

<h3 id="核心代码">核心代码</h3>

<div class="md-section-divider"></div>

<pre class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code class="language-`javascript"><span class="com">//标点函数,map为地图对象，flag代表是否只在地图上显示一个marker点,callback返回点坐标</span></code></li><li class="L1"><code class="language-`javascript"></code></li><li class="L2"><code class="language-`javascript"><span class="typ">AIMap</span><span class="pun">.</span><span class="pln">service</span><span class="pun">.</span><span class="pln">getPoint</span><span class="pun">(</span><span class="pln">map</span><span class="pun">,</span><span class="pln">flag</span><span class="pun">,</span><span class="pln">callback</span><span class="pun">)</span></code></li><li class="L3"><code class="language-`javascript"><span class="com">//调用事例如下：</span></code></li><li class="L4"><code class="language-`javascript"><span class="typ">AIMap</span><span class="pun">.</span><span class="pln">service</span><span class="pun">.</span><span class="pln">getPoint</span><span class="pun">(</span><span class="pln">myMap</span><span class="pun">,</span><span class="kwd">true</span><span class="pun">,</span><span class="kwd">function</span><span class="pun">(</span><span class="pln">e</span><span class="pun">){</span></code></li><li class="L5"><code class="language-`javascript"><span class="pln">    alert</span><span class="pun">(</span><span class="pln">e</span><span class="pun">.</span><span class="pln">point</span><span class="pun">.</span><span class="pln">lng</span><span class="pun">+</span><span class="str">"        "</span><span class="pun">+</span><span class="pln">e</span><span class="pun">.</span><span class="pln">point</span><span class="pun">.</span><span class="pln">lat</span><span class="pun">+</span><span class="str">"       "</span><span class="pun">+</span><span class="pln">e</span><span class="pun">.</span><span class="pln">type</span><span class="pun">)</span></code></li><li class="L6"><code class="language-`javascript"><span class="pun">});</span></code></li></ol></pre>

<div class="md-section-divider"></div>

<h2 id="2标点信息显示">2、标点信息显示</h2>

<div class="md-section-divider"></div>

<h3 id="功能说明-2">功能说明</h3>

<ul>
<li>在地图上展示后台保存的标记点，鼠标点击该标记点，显示信息框，展示该标点的信息（包括实时动态信息）。</li>
</ul>

<div class="md-section-divider"></div>

<h3 id="核心代码-1">核心代码</h3>

<div class="md-section-divider"></div>

<pre class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code class="language-`javascript"><span class="com">//创建标记点方法，map代表地图对象,json为点数组，renderOptions代表点信息展示的格式,callback返回标记点覆盖物数组</span></code></li><li class="L1"><code class="language-`javascript"></code></li><li class="L2"><code class="language-`javascript"><span class="typ">AIMap</span><span class="pun">.</span><span class="pln">draw</span><span class="pun">.</span><span class="pln">createMarker</span><span class="pun">(</span><span class="pln">map</span><span class="pun">,</span><span class="pln"> json</span><span class="pun">,</span><span class="pln"> renderOptions</span><span class="pun">,</span><span class="pln"> callback</span><span class="pun">)</span></code></li><li class="L3"><code class="language-`javascript"></code></li><li class="L4"><code class="language-`javascript"><span class="com">//调用事例如下：</span></code></li><li class="L5"><code class="language-`javascript"><span class="typ">AIMap</span><span class="pun">.</span><span class="pln">ajax</span><span class="pun">.</span><span class="typ">AjaxJson</span><span class="pun">(</span><span class="str">"res/data4Ext/point.json?1=1"</span><span class="pun">,</span><span class="str">''</span><span class="pun">,</span><span class="kwd">function</span><span class="pun">(</span><span class="pln">state</span><span class="pun">,</span><span class="pln">json</span><span class="pun">){</span></code></li><li class="L6"><code class="language-`javascript"><span class="pln">    </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">state</span><span class="pun">==</span><span class="str">'success'</span><span class="pun">){</span></code></li><li class="L7"><code class="language-`javascript"><span class="pln">        </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">json</span><span class="pun">&amp;&amp;</span><span class="pln">json</span><span class="pun">.</span><span class="pln">returnCode</span><span class="pun">==</span><span class="str">'1'</span><span class="pun">){</span></code></li><li class="L8"><code class="language-`javascript"><span class="pln">            </span><span class="com">//第三方修改renderOptions</span></code></li><li class="L9"><code class="language-`javascript"><span class="pln">            </span><span class="kwd">var</span><span class="pln"> renderOptions </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L0"><code class="language-`javascript"><span class="pln">                </span><span class="str">"isDrawLine"</span><span class="pun">:</span><span class="kwd">true</span><span class="pun">,</span><span class="com">//点画线</span></code></li><li class="L1"><code class="language-`javascript"><span class="pln">                </span><span class="str">"icon"</span><span class="pun">:</span><span class="pln"> json</span><span class="pun">.</span><span class="pln">points</span><span class="pun">[</span><span class="lit">0</span><span class="pun">].</span><span class="pln">icon</span><span class="pun">,</span></code></li><li class="L2"><code class="language-`javascript"><span class="pln">                </span><span class="str">"params"</span><span class="pun">:{</span></code></li><li class="L3"><code class="language-`javascript"><span class="pln">                    strokeColor</span><span class="pun">:</span><span class="str">"red"</span><span class="pun">,</span><span class="pln">    </span><span class="com">//边线颜色</span></code></li><li class="L4"><code class="language-`javascript"><span class="pln">                    fillColor</span><span class="pun">:</span><span class="str">"red"</span><span class="pun">,</span><span class="pln">      </span><span class="com">//填充颜色。当参数为空时，圆形将没有填充效果</span></code></li><li class="L5"><code class="language-`javascript"><span class="pln">                    strokeWeight</span><span class="pun">:</span><span class="pln"> </span><span class="lit">3</span><span class="pun">,</span><span class="pln">       </span><span class="com">//边线的宽度，以像素为单位</span></code></li><li class="L6"><code class="language-`javascript"><span class="pln">                    strokeOpacity</span><span class="pun">:</span><span class="pln"> </span><span class="pun">.</span><span class="lit">8</span><span class="pun">,</span><span class="pln">    </span><span class="com">//边线透明度，取值范围0-1</span></code></li><li class="L7"><code class="language-`javascript"><span class="pln">                    fillOpacity</span><span class="pun">:</span><span class="pln"> </span><span class="pun">.</span><span class="lit">3</span><span class="pun">,</span><span class="pln">      </span><span class="com">//填充的透明度，取值范围0-1</span></code></li><li class="L8"><code class="language-`javascript"><span class="pln">                    strokeStyle</span><span class="pun">:</span><span class="pln"> </span><span class="str">'solid'</span><span class="pln"> </span><span class="com">//边线的样式，solid或dashed</span></code></li><li class="L9"><code class="language-`javascript"><span class="pln">                </span><span class="pun">}</span></code></li><li class="L0"><code class="language-`javascript"><span class="pln">            </span><span class="pun">};</span></code></li><li class="L1"><code class="language-`javascript"><span class="pln">            </span><span class="typ">AIMap</span><span class="pun">.</span><span class="pln">draw</span><span class="pun">.</span><span class="pln">createMarker</span><span class="pun">(</span><span class="pln">myMap</span><span class="pun">,</span><span class="pln">json</span><span class="pun">,</span><span class="pln">renderOptions</span><span class="pun">,</span><span class="kwd">function</span><span class="pun">(</span><span class="pln">markers</span><span class="pun">){</span></code></li><li class="L2"><code class="language-`javascript"><span class="pln">            </span><span class="com">//返回标记点数组，通常不需要这个callback方法</span></code></li><li class="L3"><code class="language-`javascript"><span class="pln">            </span><span class="pun">});</span></code></li><li class="L4"><code class="language-`javascript"><span class="pln">        </span><span class="pun">}</span></code></li><li class="L5"><code class="language-`javascript"><span class="pln">    </span><span class="pun">}</span></code></li><li class="L6"><code class="language-`javascript"><span class="pun">});</span></code></li></ol></pre>

<div class="md-section-divider"></div>

<h2 id="3显示简单多边形区域">3、显示简单多边形区域</h2>

<div class="md-section-divider"></div>

<h3 id="功能说明-3">功能说明</h3>

<ul>
<li>可以在地图显示一些多边形，例如矩形，圆形，多边形等。</li>
</ul>

<div class="md-section-divider"></div>

<h3 id="核心代码-2">核心代码</h3>

<div class="md-section-divider"></div>

<pre class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code class="language-`javascript"><span class="com">//画图形方法，map代表地图对象，JSON代表区域，flag代表是否允许被清除，callback返回多边形覆盖物对象</span></code></li><li class="L1"><code class="language-`javascript"></code></li><li class="L2"><code class="language-`javascript"><span class="typ">AIMap</span><span class="pun">.</span><span class="pln">draw</span><span class="pun">.</span><span class="pln">drawShape</span><span class="pun">(</span><span class="pln">map</span><span class="pun">,</span><span class="pln">json</span><span class="pun">,</span><span class="pln">flag</span><span class="pun">,</span><span class="pln">callback</span><span class="pun">)</span></code></li><li class="L3"><code class="language-`javascript"></code></li><li class="L4"><code class="language-`javascript"><span class="com">//调用事例如下：</span></code></li><li class="L5"><code class="language-`javascript"><span class="typ">AIMap</span><span class="pun">.</span><span class="pln">ajax</span><span class="pun">.</span><span class="typ">AjaxJson</span><span class="pun">(</span><span class="str">"res/data4Ext/simpleArea.json?1=1"</span><span class="pun">,</span><span class="str">''</span><span class="pun">,</span><span class="kwd">function</span><span class="pun">(</span><span class="pln">state</span><span class="pun">,</span><span class="pln">json</span><span class="pun">){</span></code></li><li class="L6"><code class="language-`javascript"><span class="pln">    </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">state</span><span class="pun">==</span><span class="str">'success'</span><span class="pun">){</span></code></li><li class="L7"><code class="language-`javascript"><span class="pln">        </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">json</span><span class="pun">&amp;&amp;</span><span class="pln">json</span><span class="pun">.</span><span class="pln">returnCode</span><span class="pun">==</span><span class="str">'1'</span><span class="pun">){</span></code></li><li class="L8"><code class="language-`javascript"><span class="pln">            </span><span class="com">//第三方修改渲染参数</span></code></li><li class="L9"><code class="language-`javascript"><span class="pln">            json</span><span class="pun">.</span><span class="kwd">params</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L0"><code class="language-`javascript"><span class="pln">                strokeColor</span><span class="pun">:</span><span class="str">"red"</span><span class="pun">,</span><span class="pln">    </span><span class="com">//边线颜色。</span></code></li><li class="L1"><code class="language-`javascript"><span class="pln">                fillColor</span><span class="pun">:</span><span class="str">"red"</span><span class="pun">,</span><span class="pln">      </span><span class="com">//填充颜色。当参数为空时，圆形将没有填充效果。</span></code></li><li class="L2"><code class="language-`javascript"><span class="pln">                strokeWeight</span><span class="pun">:</span><span class="pln"> </span><span class="lit">3</span><span class="pun">,</span><span class="pln">       </span><span class="com">//边线的宽度，以像素为单位。</span></code></li><li class="L3"><code class="language-`javascript"><span class="pln">                strokeOpacity</span><span class="pun">:</span><span class="pln"> </span><span class="pun">.</span><span class="lit">8</span><span class="pun">,</span><span class="pln">    </span><span class="com">//边线透明度，取值范围0 - 1。</span></code></li><li class="L4"><code class="language-`javascript"><span class="pln">                fillOpacity</span><span class="pun">:</span><span class="pln"> </span><span class="pun">.</span><span class="lit">3</span><span class="pun">,</span><span class="pln">      </span><span class="com">//填充的透明度，取值范围0 - 1。</span></code></li><li class="L5"><code class="language-`javascript"><span class="pln">                strokeStyle</span><span class="pun">:</span><span class="pln"> </span><span class="str">'solid'</span><span class="pln"> </span><span class="com">//边线的样式，solid或dashed。</span></code></li><li class="L6"><code class="language-`javascript"><span class="pln">            </span><span class="pun">}</span></code></li><li class="L7"><code class="language-`javascript"><span class="pln">            </span><span class="typ">AIMap</span><span class="pun">.</span><span class="pln">draw</span><span class="pun">.</span><span class="pln">drawShape</span><span class="pun">(</span><span class="pln">myMap</span><span class="pun">,</span><span class="pln">json</span><span class="pun">,</span><span class="kwd">true</span><span class="pun">);</span></code></li><li class="L8"><code class="language-`javascript"><span class="pln">        </span><span class="pun">}</span></code></li><li class="L9"><code class="language-`javascript"><span class="pln">    </span><span class="pun">}</span></code></li><li class="L0"><code class="language-`javascript"><span class="pun">});</span></code></li></ol></pre>

<div class="md-section-divider"></div>

<h2 id="4显示多个多边形区域">4、显示多个多边形区域</h2>

<div class="md-section-divider"></div>

<h3 id="功能说明-4">功能说明</h3>

<ul>
<li>可以在地图同时显示当前区域的父区域，以及相邻的同级区域。</li>
</ul>

<div class="md-section-divider"></div>

<h3 id="核心代码-3">核心代码</h3>

<div class="md-section-divider"></div>

<pre class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code class="language-`javascript"><span class="typ">AIMap</span><span class="pun">.</span><span class="pln">ajax</span><span class="pun">.</span><span class="typ">AjaxJson</span><span class="pun">(</span><span class="str">"res/data4Ext/complexArea.json?1=1"</span><span class="pun">,</span><span class="str">''</span><span class="pun">,</span><span class="kwd">function</span><span class="pun">(</span><span class="pln">state</span><span class="pun">,</span><span class="pln">json</span><span class="pun">){</span></code></li><li class="L1"><code class="language-`javascript"><span class="pln">      </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">state</span><span class="pun">==</span><span class="str">'success'</span><span class="pun">){</span></code></li><li class="L2"><code class="language-`javascript"><span class="pln">          </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">json</span><span class="pun">&amp;&amp;</span><span class="pln">json</span><span class="pun">.</span><span class="pln">returnCode</span><span class="pun">==</span><span class="str">'1'</span><span class="pun">){</span></code></li><li class="L3"><code class="language-`javascript"><span class="pln">            </span><span class="kwd">var</span><span class="pln"> </span><span class="kwd">params</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L4"><code class="language-`javascript"><span class="pln">                strokeOpacity</span><span class="pun">:</span><span class="pln"> </span><span class="pun">.</span><span class="lit">6</span><span class="pun">,</span></code></li><li class="L5"><code class="language-`javascript"><span class="pln">                strokeWeight</span><span class="pun">:</span><span class="pln"> </span><span class="lit">3</span><span class="pun">,</span></code></li><li class="L6"><code class="language-`javascript"><span class="pln">                fillOpacity</span><span class="pun">:</span><span class="pln"> </span><span class="pun">.</span><span class="lit">4</span></code></li><li class="L7"><code class="language-`javascript"><span class="pln">            </span><span class="pun">}</span></code></li><li class="L8"><code class="language-`javascript"></code></li><li class="L9"><code class="language-`javascript"><span class="pln">            </span><span class="com">//加载父区域</span></code></li><li class="L0"><code class="language-`javascript"><span class="pln">            json</span><span class="pun">.</span><span class="pln">parentJson</span><span class="pun">.</span><span class="pln">rows</span><span class="pun">.</span><span class="kwd">params</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">params</span><span class="pun">;</span></code></li><li class="L1"><code class="language-`javascript"><span class="pln">            </span><span class="typ">AIMap</span><span class="pun">.</span><span class="pln">draw</span><span class="pun">.</span><span class="pln">drawShape</span><span class="pun">(</span><span class="pln">myMap</span><span class="pun">,</span><span class="pln">json</span><span class="pun">.</span><span class="pln">parentJson</span><span class="pun">.</span><span class="pln">rows</span><span class="pun">,</span><span class="kwd">true</span><span class="pun">,</span><span class="kwd">function</span><span class="pun">(</span><span class="pln">shape</span><span class="pun">){});</span></code></li><li class="L2"><code class="language-`javascript"></code></li><li class="L3"><code class="language-`javascript"><span class="pln">            </span><span class="com">//加载相邻同级区域</span></code></li><li class="L4"><code class="language-`javascript"><span class="pln">            </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">var</span><span class="pln"> i</span><span class="pun">=</span><span class="lit">0</span><span class="pun">,</span><span class="pln">length</span><span class="pun">=</span><span class="pln">json</span><span class="pun">.</span><span class="pln">rows</span><span class="pun">.</span><span class="pln">length</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">&lt;</span><span class="pln">length</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++){</span></code></li><li class="L5"><code class="language-`javascript"><span class="pln">                json</span><span class="pun">.</span><span class="pln">rows</span><span class="pun">[</span><span class="pln">i</span><span class="pun">].</span><span class="pln">areaJson</span><span class="pun">.</span><span class="pln">rows</span><span class="pun">.</span><span class="kwd">params</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">params</span><span class="pun">;</span></code></li><li class="L6"><code class="language-`javascript"><span class="pln">                </span><span class="typ">AIMap</span><span class="pun">.</span><span class="pln">draw</span><span class="pun">.</span><span class="pln">drawShape</span><span class="pun">(</span><span class="pln">myMap</span><span class="pun">,</span><span class="pln">json</span><span class="pun">.</span><span class="pln">rows</span><span class="pun">[</span><span class="pln">i</span><span class="pun">].</span><span class="pln">areaJson</span><span class="pun">.</span><span class="pln">rows</span><span class="pun">,</span><span class="kwd">true</span><span class="pun">,</span><span class="kwd">function</span><span class="pun">(</span><span class="pln">shape</span><span class="pun">){});</span></code></li><li class="L7"><code class="language-`javascript"><span class="pln">            </span><span class="pun">}</span></code></li><li class="L8"><code class="language-`javascript"></code></li><li class="L9"><code class="language-`javascript"><span class="pln">            </span><span class="com">//加载自己区域</span></code></li><li class="L0"><code class="language-`javascript"><span class="pln">            </span><span class="typ">AIMap</span><span class="pun">.</span><span class="pln">draw</span><span class="pun">.</span><span class="pln">drawShape</span><span class="pun">(</span><span class="pln">myMap</span><span class="pun">,</span><span class="pln">json</span><span class="pun">.</span><span class="pln">selfJson</span><span class="pun">.</span><span class="pln">rows</span><span class="pun">,</span><span class="kwd">true</span><span class="pun">,</span><span class="kwd">function</span><span class="pun">(</span><span class="pln">shape</span><span class="pun">){});</span></code></li><li class="L1"><code class="language-`javascript"><span class="pln">          </span><span class="pun">}</span></code></li><li class="L2"><code class="language-`javascript"><span class="pln">      </span><span class="pun">}</span></code></li><li class="L3"><code class="language-`javascript"><span class="pln">  </span><span class="pun">});</span></code></li></ol></pre>

<div class="md-section-divider"></div>

<h2 id="5单个区域绘制">5、单个区域绘制</h2>

<div class="md-section-divider"></div>

<h3 id="功能说明-5">功能说明</h3>

<ul>
<li>在地图上通过标点的方式画出一片区域,在点击获取区域内标记点链接，就会在这片区域内显示标记点。</li>
<li>由于使用到了区域绘制功能，需要引入DrawingManager.js以及DrawingManager_min.css。</li>
</ul>

<div class="md-section-divider"></div>

<h3 id="核心代码-4">核心代码</h3>

<div class="md-section-divider"></div>

<pre class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code class="language-`javascript"><span class="com">// 绘制区域标点方法,map是需传入地图对象，drawingManager为绘制工具对象，overlays为当前页面的覆盖物，flag代表是否开启绘制工具,type为是否需要校验超出父区域,parentArea代表父区域，callback返回的是区域json</span></code></li><li class="L1"><code class="language-`javascript"></code></li><li class="L2"><code class="language-`javascript"><span class="typ">AIMap</span><span class="pun">.</span><span class="pln">draw</span><span class="pun">.</span><span class="pln">drawAreaMarker</span><span class="pun">(</span><span class="pln">map</span><span class="pun">,</span><span class="pln">drawingManager</span><span class="pun">,</span><span class="pln">overlays</span><span class="pun">,</span><span class="pln">flag</span><span class="pun">,</span><span class="pln">type</span><span class="pun">,</span><span class="pln">parentArea</span><span class="pun">,</span><span class="pln">callback</span><span class="pun">);</span></code></li><li class="L3"><code class="language-`javascript"></code></li><li class="L4"><code class="language-`javascript"><span class="com">//创建画图工具方法,map代表地图对象，params为图形渲染方式，该函数返回一个工具对象</span></code></li><li class="L5"><code class="language-`javascript"><span class="typ">AIMap</span><span class="pun">.</span><span class="pln">draw</span><span class="pun">.</span><span class="pln">createDrawingManager</span><span class="pun">(</span><span class="pln">map</span><span class="pun">,</span><span class="kwd">params</span><span class="pun">)</span></code></li><li class="L6"><code class="language-`javascript"></code></li><li class="L7"><code class="language-`javascript"><span class="com">// 调用事例如下：</span></code></li><li class="L8"><code class="language-`javascript"><span class="kwd">var</span><span class="pln"> G_json</span><span class="pun">;</span></code></li><li class="L9"><code class="language-`javascript"><span class="pln">      </span><span class="com">//初始化画图工具</span></code></li><li class="L0"><code class="language-`javascript"><span class="pln">      </span><span class="kwd">var</span><span class="pln"> drawingManager </span><span class="pun">=</span><span class="pln"> </span><span class="typ">AIMap</span><span class="pun">.</span><span class="pln">draw</span><span class="pun">.</span><span class="pln">createDrawingManager</span><span class="pun">(</span><span class="pln">myMap</span><span class="pun">,</span><span class="str">""</span><span class="pun">);</span></code></li><li class="L1"><code class="language-`javascript"><span class="pln">      </span><span class="com">//装载标记点，类型为标记点数组</span></code></li><li class="L2"><code class="language-`javascript"><span class="pln">      </span><span class="kwd">var</span><span class="pln"> areaMarker </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[];</span></code></li><li class="L3"><code class="language-`javascript"><span class="pln">      </span><span class="com">//装载父区域，类型为多边形覆盖物</span></code></li><li class="L4"><code class="language-`javascript"><span class="pln">      </span><span class="kwd">var</span><span class="pln"> parentArea</span><span class="pun">;</span></code></li><li class="L5"><code class="language-`javascript"><span class="pln">      </span><span class="com">//根据drawingModes判断，当为0或者false的时候，不需要考虑超出区域，目前为点与多边形的关系，3；</span></code></li><li class="L6"><code class="language-`javascript"><span class="pln">      </span><span class="kwd">var</span><span class="pln"> type </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span></code></li><li class="L7"><code class="language-`javascript"><span class="pln">      </span><span class="com">//监听绘图完成事件</span></code></li><li class="L8"><code class="language-`javascript"><span class="pln">      drawingManager</span><span class="pun">.</span><span class="pln">addEventListener</span><span class="pun">(</span><span class="str">'overlaycomplete'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">e</span><span class="pun">){</span></code></li><li class="L9"><code class="language-`javascript"><span class="pln">        </span><span class="com">//标点画区域</span></code></li><li class="L0"><code class="language-`javascript"><span class="pln">        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">e</span><span class="pun">.</span><span class="pln">drawingMode </span><span class="pun">==</span><span class="pln"> BMAP_DRAWING_MARKER</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L1"><code class="language-`javascript"><span class="pln">            </span><span class="com">//判断是否超出区域</span></code></li><li class="L2"><code class="language-`javascript"><span class="pln">            </span><span class="kwd">var</span><span class="pln"> point </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">AIMap</span><span class="pun">.</span><span class="typ">Point</span><span class="pun">(</span><span class="pln">e</span><span class="pun">.</span><span class="pln">overlay</span><span class="pun">.</span><span class="pln">getPosition</span><span class="pun">().</span><span class="pln">lng</span><span class="pun">,</span><span class="pln"> e</span><span class="pun">.</span><span class="pln">overlay</span><span class="pun">.</span><span class="pln">getPosition</span><span class="pun">().</span><span class="pln">lat</span><span class="pun">);</span></code></li><li class="L3"><code class="language-`javascript"></code></li><li class="L4"><code class="language-`javascript"><span class="pln">            areaMarker</span><span class="pun">.</span><span class="pln">push</span><span class="pun">(</span><span class="pln">point</span><span class="pun">);</span></code></li><li class="L5"><code class="language-`javascript"></code></li><li class="L6"><code class="language-`javascript"><span class="pln">            </span><span class="typ">AIMap</span><span class="pun">.</span><span class="pln">draw</span><span class="pun">.</span><span class="pln">drawAreaMarker</span><span class="pun">(</span><span class="pln">myMap</span><span class="pun">,</span><span class="pln">drawingManager</span><span class="pun">,</span><span class="pln">areaMarker</span><span class="pun">,</span><span class="kwd">true</span><span class="pun">,</span><span class="pln">type</span><span class="pun">,</span><span class="pln">parentArea</span><span class="pun">,</span><span class="kwd">function</span><span class="pun">(</span><span class="pln">data</span><span class="pun">){</span></code></li><li class="L7"><code class="language-`javascript"><span class="pln">                </span><span class="com">//data表示返回的区域json</span></code></li><li class="L8"><code class="language-`javascript"><span class="pln">                G_json </span><span class="pun">=</span><span class="pln"> data</span><span class="pun">;</span></code></li><li class="L9"><code class="language-`javascript"><span class="pln">            </span><span class="pun">});</span></code></li><li class="L0"><code class="language-`javascript"><span class="pln">        </span><span class="pun">}</span></code></li><li class="L1"><code class="language-`javascript"><span class="pln">    </span><span class="pun">});</span></code></li><li class="L2"><code class="language-`javascript"><span class="pln">    $</span><span class="pun">(</span><span class="str">"#getMark"</span><span class="pun">).</span><span class="pln">unbind</span><span class="pun">(</span><span class="str">"click"</span><span class="pun">).</span><span class="pln">bind</span><span class="pun">(</span><span class="str">"click"</span><span class="pun">,</span><span class="kwd">function</span><span class="pun">(){</span></code></li><li class="L3"><code class="language-`javascript"><span class="pln">        </span><span class="kwd">var</span><span class="pln"> json</span><span class="pun">=</span><span class="pln">encodeBase64</span><span class="pun">(</span><span class="pln">encodeURIComponent</span><span class="pun">(</span><span class="pln">JSON</span><span class="pun">.</span><span class="pln">stringify</span><span class="pun">(</span><span class="pln">G_json</span><span class="pun">)));</span></code></li><li class="L4"><code class="language-`javascript"><span class="pln">        </span><span class="kwd">var</span><span class="pln"> keyword </span><span class="pun">=</span><span class="pln"> </span><span class="str">""</span><span class="pun">;</span></code></li><li class="L5"><code class="language-`javascript"><span class="pln">        </span><span class="typ">AIMap</span><span class="pun">.</span><span class="pln">ajax</span><span class="pun">.</span><span class="typ">AjaxJson</span><span class="pun">(</span><span class="str">"hz/sdkaction/common.action?uid=getMarkPointByArea"</span><span class="pun">,</span><span class="str">"overlayjson="</span><span class="pun">+</span><span class="pln">json</span><span class="pun">+</span><span class="str">"&amp;keyword="</span><span class="pun">+</span><span class="pln">keyword</span><span class="pun">+</span><span class="str">"&amp;appId=7"</span><span class="pun">,</span><span class="kwd">function</span><span class="pun">(</span><span class="pln">state</span><span class="pun">,</span><span class="pln">json</span><span class="pun">){</span></code></li><li class="L6"><code class="language-`javascript"><span class="pln">            </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">state</span><span class="pun">==</span><span class="str">"success"</span><span class="pun">){</span></code></li><li class="L7"><code class="language-`javascript"><span class="pln">                </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">json</span><span class="pun">&amp;&amp;</span><span class="pln">json</span><span class="pun">.</span><span class="pln">returnCode</span><span class="pun">==</span><span class="str">'1'</span><span class="pun">){</span></code></li><li class="L8"><code class="language-`javascript"><span class="pln">                    </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">json</span><span class="pun">.</span><span class="pln">points</span><span class="pun">.</span><span class="pln">length</span><span class="pun">&gt;</span><span class="lit">0</span><span class="pun">){</span></code></li><li class="L9"><code class="language-`javascript"><span class="pln">                        </span><span class="kwd">var</span><span class="pln"> json </span><span class="pun">=</span><span class="pln"> json</span><span class="pun">;</span></code></li><li class="L0"><code class="language-`javascript"><span class="pln">                        </span><span class="kwd">var</span><span class="pln"> renderOptions </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L1"><code class="language-`javascript"><span class="pln">                            </span><span class="str">"icon"</span><span class="pun">:</span><span class="pln"> json</span><span class="pun">.</span><span class="pln">points</span><span class="pun">[</span><span class="lit">0</span><span class="pun">].</span><span class="pln">icon</span></code></li><li class="L2"><code class="language-`javascript"><span class="pln">                        </span><span class="pun">};</span></code></li><li class="L3"><code class="language-`javascript"></code></li><li class="L4"><code class="language-`javascript"><span class="pln">                        </span><span class="kwd">var</span><span class="pln"> newJson </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{},</span><span class="pln">zpoints </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[];</span></code></li><li class="L5"><code class="language-`javascript"></code></li><li class="L6"><code class="language-`javascript"><span class="pln">                        </span><span class="com">//区域json转换成标准百度区域格式</span></code></li><li class="L7"><code class="language-`javascript"><span class="pln">                        </span><span class="kwd">var</span><span class="pln"> shape </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">AIMap</span><span class="pun">.</span><span class="typ">Polygon</span><span class="pun">(</span><span class="pln">G_json</span><span class="pun">.</span><span class="pln">points</span><span class="pun">,</span><span class="pln"> G_json</span><span class="pun">.</span><span class="kwd">params</span><span class="pun">);</span></code></li><li class="L8"><code class="language-`javascript"></code></li><li class="L9"><code class="language-`javascript"><span class="pln">                        </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">var</span><span class="pln"> i</span><span class="pun">=</span><span class="lit">0</span><span class="pun">,</span><span class="pln">length</span><span class="pun">=</span><span class="pln">json</span><span class="pun">.</span><span class="pln">points</span><span class="pun">.</span><span class="pln">length</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">&lt;</span><span class="pln">length</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++){</span></code></li><li class="L0"><code class="language-`javascript"><span class="pln">                            </span><span class="com">//如果超出了区域范围则去除掉</span></code></li><li class="L1"><code class="language-`javascript"><span class="pln">                            </span><span class="kwd">var</span><span class="pln"> flag </span><span class="pun">=</span><span class="pln"> </span><span class="typ">AIMap</span><span class="pun">.</span><span class="pln">service</span><span class="pun">.</span><span class="pln">ptInPolygon</span><span class="pun">(</span><span class="lit">1</span><span class="pun">,</span><span class="kwd">new</span><span class="pln"> </span><span class="typ">AIMap</span><span class="pun">.</span><span class="typ">Point</span><span class="pun">(</span><span class="pln">json</span><span class="pun">.</span><span class="pln">points</span><span class="pun">[</span><span class="pln">i</span><span class="pun">].</span><span class="pln">lng</span><span class="pun">,</span><span class="pln"> json</span><span class="pun">.</span><span class="pln">points</span><span class="pun">[</span><span class="pln">i</span><span class="pun">].</span><span class="pln">lat</span><span class="pun">),</span><span class="pln"> shape</span><span class="pun">);</span></code></li><li class="L2"><code class="language-`javascript"><span class="pln">                            </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">flag</span><span class="pun">){</span><span class="com">//说明在区域内</span></code></li><li class="L3"><code class="language-`javascript"><span class="pln">                                zpoints</span><span class="pun">.</span><span class="pln">push</span><span class="pun">(</span><span class="pln">json</span><span class="pun">.</span><span class="pln">points</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]);</span></code></li><li class="L4"><code class="language-`javascript"><span class="pln">                            </span><span class="pun">}</span></code></li><li class="L5"><code class="language-`javascript"><span class="pln">                        </span><span class="pun">}</span></code></li><li class="L6"><code class="language-`javascript"><span class="pln">                        newJson</span><span class="pun">.</span><span class="pln">points </span><span class="pun">=</span><span class="pln"> zpoints</span><span class="pun">;</span></code></li><li class="L7"><code class="language-`javascript"></code></li><li class="L8"><code class="language-`javascript"><span class="pln">                        </span><span class="typ">AIMap</span><span class="pun">.</span><span class="pln">draw</span><span class="pun">.</span><span class="pln">createMarker</span><span class="pun">(</span><span class="pln">myMap</span><span class="pun">,</span><span class="pln"> newJson</span><span class="pun">,</span><span class="pln"> renderOptions</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">marker</span><span class="pun">){</span></code></li><li class="L9"><code class="language-`javascript"><span class="pln">                            </span><span class="com">//方法返回marker组</span></code></li><li class="L0"><code class="language-`javascript"><span class="pln">                            </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">marker</span><span class="pun">.</span><span class="pln">length</span><span class="pun">){</span></code></li><li class="L1"><code class="language-`javascript"><span class="pln">                                </span><span class="kwd">var</span><span class="pln"> point </span><span class="pun">=</span><span class="pln"> marker</span><span class="pun">[</span><span class="lit">0</span><span class="pun">].</span><span class="pln">getPosition</span><span class="pun">();</span></code></li><li class="L2"><code class="language-`javascript"><span class="pln">                                myMap</span><span class="pun">.</span><span class="pln">centerAndZoom</span><span class="pun">(</span><span class="pln">point</span><span class="pun">,</span><span class="pln"> </span><span class="lit">15</span><span class="pun">);</span></code></li><li class="L3"><code class="language-`javascript"><span class="pln">                            </span><span class="pun">}</span></code></li><li class="L4"><code class="language-`javascript"><span class="pln">                        </span><span class="pun">});</span></code></li><li class="L5"><code class="language-`javascript"><span class="pln">                    </span><span class="pun">}</span><span class="kwd">else</span><span class="pun">{</span></code></li><li class="L6"><code class="language-`javascript"><span class="pln">                        alert</span><span class="pun">(</span><span class="str">"该区域未查找到标记点！"</span><span class="pun">);</span></code></li><li class="L7"><code class="language-`javascript"><span class="pln">                    </span><span class="pun">}</span></code></li><li class="L8"><code class="language-`javascript"><span class="pln">                </span><span class="pun">}</span><span class="kwd">else</span><span class="pun">{</span></code></li><li class="L9"><code class="language-`javascript"><span class="pln">                    alert</span><span class="pun">(</span><span class="str">"系统错误，请稍后再试！"</span><span class="pun">);</span></code></li><li class="L0"><code class="language-`javascript"><span class="pln">                </span><span class="pun">}</span></code></li><li class="L1"><code class="language-`javascript"><span class="pln">            </span><span class="pun">}</span><span class="kwd">else</span><span class="pun">{</span></code></li><li class="L2"><code class="language-`javascript"><span class="pln">                alert</span><span class="pun">(</span><span class="str">"系统错误，请稍后再试！"</span><span class="pun">);</span></code></li><li class="L3"><code class="language-`javascript"><span class="pln">            </span><span class="pun">}</span></code></li><li class="L4"><code class="language-`javascript"><span class="pln">        </span><span class="pun">});</span></code></li><li class="L5"><code class="language-`javascript"><span class="pln">    </span><span class="pun">})</span></code></li></ol></pre>

<div class="md-section-divider"></div>

<h2 id="6检验父区域绘制">6、检验父区域绘制</h2>

<div class="md-section-divider"></div>

<h3 id="功能说明-6">功能说明</h3>

<ul>
<li>检验当前所画子区域是否在其父区域内</li>
</ul>

<div class="md-section-divider"></div>

<h3 id="核心代码-5">核心代码</h3>

<div class="md-section-divider"></div>

<pre class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code class="language-`javascript"><span class="com">// 调用事例如下：</span></code></li><li class="L1"><code class="language-`javascript"><span class="kwd">var</span><span class="pln"> parentArea</span><span class="pun">,</span><span class="pln">areaMarker</span><span class="pun">=[],</span><span class="pln">type</span><span class="pun">=</span><span class="lit">1</span><span class="pun">,</span><span class="pln">tempJ</span><span class="pun">=[];</span></code></li><li class="L2"><code class="language-`javascript"></code></li><li class="L3"><code class="language-`javascript"><span class="typ">AIMap</span><span class="pun">.</span><span class="pln">ajax</span><span class="pun">.</span><span class="typ">AjaxJson</span><span class="pun">(</span><span class="str">"res/data4Ext/complexArea.json?1=1"</span><span class="pun">,</span><span class="str">""</span><span class="pun">,</span><span class="kwd">function</span><span class="pun">(</span><span class="pln">state</span><span class="pun">,</span><span class="pln">json</span><span class="pun">){</span></code></li><li class="L4"><code class="language-`javascript"><span class="pln">  </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">state</span><span class="pun">==</span><span class="str">'success'</span><span class="pun">){</span></code></li><li class="L5"><code class="language-`javascript"><span class="pln">    </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">json</span><span class="pun">&amp;&amp;</span><span class="pln">json</span><span class="pun">.</span><span class="pln">returnCode</span><span class="pun">==</span><span class="str">'1'</span><span class="pun">){</span></code></li><li class="L6"><code class="language-`javascript"><span class="pln">        </span><span class="kwd">var</span><span class="pln"> </span><span class="kwd">params</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L7"><code class="language-`javascript"><span class="pln">            strokeOpacity</span><span class="pun">:</span><span class="pln"> </span><span class="pun">.</span><span class="lit">6</span><span class="pun">,</span></code></li><li class="L8"><code class="language-`javascript"><span class="pln">            strokeWeight</span><span class="pun">:</span><span class="pln"> </span><span class="lit">3</span><span class="pun">,</span></code></li><li class="L9"><code class="language-`javascript"><span class="pln">            fillOpacity</span><span class="pun">:</span><span class="pln"> </span><span class="pun">.</span><span class="lit">4</span></code></li><li class="L0"><code class="language-`javascript"><span class="pln">        </span><span class="pun">}</span></code></li><li class="L1"><code class="language-`javascript"></code></li><li class="L2"><code class="language-`javascript"><span class="pln">        </span><span class="com">//显示获取父节点区域--不让删除</span></code></li><li class="L3"><code class="language-`javascript"><span class="pln">        json</span><span class="pun">.</span><span class="pln">parentJson</span><span class="pun">.</span><span class="pln">rows</span><span class="pun">.</span><span class="kwd">params</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">params</span><span class="pun">;</span></code></li><li class="L4"><code class="language-`javascript"><span class="pln">        parentArea </span><span class="pun">=</span><span class="pln"> </span><span class="typ">AIMap</span><span class="pun">.</span><span class="pln">draw</span><span class="pun">.</span><span class="pln">drawShape</span><span class="pun">(</span><span class="pln">myMap</span><span class="pun">,</span><span class="pln">json</span><span class="pun">.</span><span class="pln">parentJson</span><span class="pun">.</span><span class="pln">rows</span><span class="pun">,</span><span class="kwd">true</span><span class="pun">);</span></code></li><li class="L5"><code class="language-`javascript"><span class="pln">        tempJ </span><span class="pun">=</span><span class="pln"> json</span><span class="pun">.</span><span class="pln">parentJson</span><span class="pun">.</span><span class="pln">rows</span><span class="pun">.</span><span class="pln">points</span><span class="pun">;</span></code></li><li class="L6"><code class="language-`javascript"></code></li><li class="L7"><code class="language-`javascript"><span class="pln">        </span><span class="com">//显示获取自身区域--需要删除</span></code></li><li class="L8"><code class="language-`javascript"><span class="pln">        areaMarker </span><span class="pun">=</span><span class="pln"> json</span><span class="pun">.</span><span class="pln">selfJson</span><span class="pun">.</span><span class="pln">rows</span><span class="pun">.</span><span class="pln">points</span><span class="pun">;</span></code></li><li class="L9"><code class="language-`javascript"></code></li><li class="L0"><code class="language-`javascript"><span class="pln">        </span><span class="com">//显示获取同级节点区域--不让删除</span></code></li><li class="L1"><code class="language-`javascript"><span class="pln">        </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">var</span><span class="pln"> i</span><span class="pun">=</span><span class="lit">0</span><span class="pun">,</span><span class="pln">length</span><span class="pun">=</span><span class="pln">json</span><span class="pun">.</span><span class="pln">rows</span><span class="pun">.</span><span class="pln">length</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">&lt;</span><span class="pln">length</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++){</span></code></li><li class="L2"><code class="language-`javascript"><span class="pln">            json</span><span class="pun">.</span><span class="pln">rows</span><span class="pun">[</span><span class="pln">i</span><span class="pun">].</span><span class="pln">areaJson</span><span class="pun">.</span><span class="pln">rows</span><span class="pun">.</span><span class="kwd">params</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">params</span><span class="pun">;</span></code></li><li class="L3"><code class="language-`javascript"><span class="pln">            </span><span class="typ">AIMap</span><span class="pun">.</span><span class="pln">draw</span><span class="pun">.</span><span class="pln">drawShape</span><span class="pun">(</span><span class="pln">myMap</span><span class="pun">,</span><span class="pln">json</span><span class="pun">.</span><span class="pln">rows</span><span class="pun">[</span><span class="pln">i</span><span class="pun">].</span><span class="pln">areaJson</span><span class="pun">.</span><span class="pln">rows</span><span class="pun">,</span><span class="kwd">true</span><span class="pun">);</span></code></li><li class="L4"><code class="language-`javascript"></code></li><li class="L5"><code class="language-`javascript"><span class="pln">            </span><span class="kwd">var</span><span class="pln"> zPoint </span><span class="pun">=</span><span class="pln"> json</span><span class="pun">.</span><span class="pln">rows</span><span class="pun">[</span><span class="pln">i</span><span class="pun">].</span><span class="pln">areaJson</span><span class="pun">.</span><span class="pln">rows</span><span class="pun">.</span><span class="pln">points</span><span class="pun">;</span></code></li><li class="L6"><code class="language-`javascript"><span class="pln">            </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">var</span><span class="pln"> j</span><span class="pun">=</span><span class="lit">0</span><span class="pun">,</span><span class="pln">zlength</span><span class="pun">=</span><span class="pln">zPoint</span><span class="pun">.</span><span class="pln">length</span><span class="pun">;</span><span class="pln"> j</span><span class="pun">&lt;</span><span class="pln">zlength</span><span class="pun">;</span><span class="pln"> j</span><span class="pun">++){</span></code></li><li class="L7"><code class="language-`javascript"><span class="pln">                tempJ</span><span class="pun">.</span><span class="pln">push</span><span class="pun">(</span><span class="pln">zPoint</span><span class="pun">[</span><span class="pln">j</span><span class="pun">]);</span></code></li><li class="L8"><code class="language-`javascript"><span class="pln">            </span><span class="pun">}</span></code></li><li class="L9"><code class="language-`javascript"><span class="pln">        </span><span class="pun">}</span></code></li><li class="L0"><code class="language-`javascript"></code></li><li class="L1"><code class="language-`javascript"><span class="pln">        </span><span class="com">//初始化画图工具</span></code></li><li class="L2"><code class="language-`javascript"><span class="pln">        </span><span class="kwd">var</span><span class="pln"> drawingManager </span><span class="pun">=</span><span class="pln"> </span><span class="typ">AIMap</span><span class="pun">.</span><span class="pln">draw</span><span class="pun">.</span><span class="pln">createDrawingManager</span><span class="pun">(</span><span class="pln">myMap</span><span class="pun">,</span><span class="str">""</span><span class="pun">);</span></code></li><li class="L3"><code class="language-`javascript"></code></li><li class="L4"><code class="language-`javascript"><span class="pln">        </span><span class="com">//显示标记点，开启编辑</span></code></li><li class="L5"><code class="language-`javascript"><span class="pln">        </span><span class="typ">AIMap</span><span class="pun">.</span><span class="pln">draw</span><span class="pun">.</span><span class="pln">drawAreaMarker</span><span class="pun">(</span><span class="pln">myMap</span><span class="pun">,</span><span class="pln">drawingManager</span><span class="pun">,</span><span class="pln">areaMarker</span><span class="pun">,</span><span class="kwd">true</span><span class="pun">,</span><span class="pln">type</span><span class="pun">,</span><span class="pln">parentArea</span><span class="pun">,</span><span class="kwd">function</span><span class="pun">(</span><span class="pln">data</span><span class="pun">){});</span></code></li><li class="L6"><code class="language-`javascript"></code></li><li class="L7"><code class="language-`javascript"><span class="pln">        </span><span class="com">//监听绘图完成事件</span></code></li><li class="L8"><code class="language-`javascript"><span class="pln">        drawingManager</span><span class="pun">.</span><span class="pln">addEventListener</span><span class="pun">(</span><span class="str">'overlaycomplete'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">e</span><span class="pun">){</span></code></li><li class="L9"><code class="language-`javascript"><span class="pln">            </span><span class="com">//标点画区域</span></code></li><li class="L0"><code class="language-`javascript"><span class="pln">            </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">e</span><span class="pun">.</span><span class="pln">drawingMode </span><span class="pun">==</span><span class="pln"> BMAP_DRAWING_MARKER</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L1"><code class="language-`javascript"><span class="pln">                </span><span class="com">//判断是否超出区域</span></code></li><li class="L2"><code class="language-`javascript"><span class="pln">                </span><span class="kwd">var</span><span class="pln"> point </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">AIMap</span><span class="pun">.</span><span class="typ">Point</span><span class="pun">(</span><span class="pln">e</span><span class="pun">.</span><span class="pln">overlay</span><span class="pun">.</span><span class="pln">getPosition</span><span class="pun">().</span><span class="pln">lng</span><span class="pun">,</span><span class="pln"> e</span><span class="pun">.</span><span class="pln">overlay</span><span class="pun">.</span><span class="pln">getPosition</span><span class="pun">().</span><span class="pln">lat</span><span class="pun">);</span></code></li><li class="L3"><code class="language-`javascript"><span class="pln">                </span><span class="kwd">var</span><span class="pln"> flag </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">;</span><span class="com">//父节点</span></code></li><li class="L4"><code class="language-`javascript"><span class="pln">                </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">type</span><span class="pun">){</span></code></li><li class="L5"><code class="language-`javascript"><span class="pln">                    </span><span class="com">//判断是否超出父节点</span></code></li><li class="L6"><code class="language-`javascript"><span class="pln">                    flag </span><span class="pun">=</span><span class="pln"> </span><span class="typ">AIMap</span><span class="pun">.</span><span class="pln">service</span><span class="pun">.</span><span class="pln">ptInPolygon</span><span class="pun">(</span><span class="pln">type</span><span class="pun">,</span><span class="pln"> point</span><span class="pun">,</span><span class="pln"> parentArea</span><span class="pun">);</span></code></li><li class="L7"><code class="language-`javascript"><span class="pln">                </span><span class="pun">}</span></code></li><li class="L8"><code class="language-`javascript"><span class="pln">                </span><span class="kwd">if</span><span class="pun">(!</span><span class="pln">flag</span><span class="pun">){</span></code></li><li class="L9"><code class="language-`javascript"><span class="pln">                    alert</span><span class="pun">(</span><span class="str">"标点超出父区域范围！"</span><span class="pun">);</span></code></li><li class="L0"><code class="language-`javascript"><span class="pln">                    </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">;</span></code></li><li class="L1"><code class="language-`javascript"><span class="pln">                </span><span class="pun">}</span></code></li><li class="L2"><code class="language-`javascript"></code></li><li class="L3"><code class="language-`javascript"><span class="pln">                </span><span class="com">//自动贴近</span></code></li><li class="L4"><code class="language-`javascript"><span class="pln">                </span><span class="kwd">var</span><span class="pln"> zidongIndex </span><span class="pun">=</span><span class="pln"> </span><span class="typ">AIMap_getIndex</span><span class="pun">(</span><span class="pln">tempJ</span><span class="pun">,</span><span class="pln">point</span><span class="pun">);</span></code></li><li class="L5"><code class="language-`javascript"><span class="pln">                </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">zidongIndex </span><span class="pun">!=</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pun">){</span></code></li><li class="L6"><code class="language-`javascript"><span class="pln">                    </span><span class="com">//更换json.points中被拖动了的点</span></code></li><li class="L7"><code class="language-`javascript"><span class="pln">                    point</span><span class="pun">.</span><span class="pln">lng </span><span class="pun">=</span><span class="pln"> tempJ</span><span class="pun">[</span><span class="pln">zidongIndex</span><span class="pun">].</span><span class="pln">lng</span><span class="pun">;</span></code></li><li class="L8"><code class="language-`javascript"><span class="pln">                    point</span><span class="pun">.</span><span class="pln">lat </span><span class="pun">=</span><span class="pln"> tempJ</span><span class="pun">[</span><span class="pln">zidongIndex</span><span class="pun">].</span><span class="pln">lat</span><span class="pun">;</span></code></li><li class="L9"><code class="language-`javascript"><span class="pln">                </span><span class="pun">}</span></code></li><li class="L0"><code class="language-`javascript"></code></li><li class="L1"><code class="language-`javascript"><span class="pln">                areaMarker</span><span class="pun">.</span><span class="pln">push</span><span class="pun">(</span><span class="pln">point</span><span class="pun">);</span></code></li><li class="L2"><code class="language-`javascript"></code></li><li class="L3"><code class="language-`javascript"><span class="pln">                </span><span class="typ">AIMap</span><span class="pun">.</span><span class="pln">draw</span><span class="pun">.</span><span class="pln">drawAreaMarker</span><span class="pun">(</span><span class="pln">myMap</span><span class="pun">,</span><span class="pln">drawingManager</span><span class="pun">,</span><span class="pln">areaMarker</span><span class="pun">,</span><span class="kwd">true</span><span class="pun">,</span><span class="pln">type</span><span class="pun">,</span><span class="pln">parentArea</span><span class="pun">,</span><span class="kwd">function</span><span class="pun">(</span><span class="pln">data</span><span class="pun">){</span></code></li><li class="L4"><code class="language-`javascript"><span class="pln">                    </span><span class="com">// console.log(JSON.stringify(data));</span></code></li><li class="L5"><code class="language-`javascript"><span class="pln">                </span><span class="pun">});</span></code></li><li class="L6"><code class="language-`javascript"><span class="pln">            </span><span class="pun">}</span></code></li><li class="L7"><code class="language-`javascript"><span class="pln">        </span><span class="pun">});</span></code></li><li class="L8"><code class="language-`javascript"><span class="pln">    </span><span class="pun">}</span></code></li><li class="L9"><code class="language-`javascript"><span class="pln">  </span><span class="pun">}</span></code></li><li class="L0"><code class="language-`javascript"><span class="pun">});</span></code></li></ol></pre>

<div class="md-section-divider"></div>

<h2 id="7按id数组显示节点">7、按ID数组显示节点</h2>

<div class="md-section-divider"></div>

<h3 id="功能说明-7">功能说明</h3>

<ul>
<li>第三方应用返回指定ID的数组给GIS系统，GIS系统在地图上对数组进行显示</li>
</ul>

<div class="md-section-divider"></div>

<h3 id="核心代码-6">核心代码</h3>

<div class="md-section-divider"></div>

<pre class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code class="language-`javascript"><span class="com">//调用事例如下：</span></code></li><li class="L1"><code class="language-`javascript"><span class="kwd">var</span><span class="pln"> longArr </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[];</span></code></li><li class="L2"><code class="language-`javascript"><span class="kwd">for</span><span class="pun">(</span><span class="kwd">var</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> </span><span class="lit">300</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++){</span></code></li><li class="L3"><code class="language-`javascript"><span class="pln">    </span><span class="com">// 模拟一个超长的数组</span></code></li><li class="L4"><code class="language-`javascript"><span class="pln">    longArr</span><span class="pun">.</span><span class="pln">push</span><span class="pun">(</span><span class="pln">i</span><span class="pun">);</span></code></li><li class="L5"><code class="language-`javascript"><span class="pun">}</span></code></li><li class="L6"><code class="language-`javascript"><span class="kwd">var</span><span class="pln"> shortArrs </span><span class="pun">=</span><span class="pln"> </span><span class="typ">AIMap_splitArray</span><span class="pun">(</span><span class="pln">longArr</span><span class="pun">,</span><span class="lit">225</span><span class="pun">);</span></code></li><li class="L7"><code class="language-`javascript"><span class="pln">count </span><span class="pun">=</span><span class="pln"> shortArrs</span><span class="pun">.</span><span class="pln">length</span><span class="pun">;</span></code></li><li class="L8"><code class="language-`javascript"><span class="kwd">for</span><span class="pun">(</span><span class="kwd">var</span><span class="pln"> i</span><span class="pun">=</span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">&lt;</span><span class="pln">count</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++){</span></code></li><li class="L9"><code class="language-`javascript"><span class="pln">  </span><span class="com">//回调方法在AIMap_jsonp</span></code></li><li class="L0"><code class="language-`javascript"><span class="pln">    </span><span class="typ">AIMap</span><span class="pun">.</span><span class="pln">ajax</span><span class="pun">.</span><span class="typ">AjaxJsonp</span><span class="pun">(</span><span class="str">"http://files.cnblogs.com/zhouweihny/ztreePoint.js"</span><span class="pun">,</span><span class="str">"callback=AIMap_jsonp&amp;wd="</span><span class="pun">+</span><span class="pln">shortArrs</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]);</span></code></li><li class="L1"><code class="language-`javascript"><span class="pun">}</span></code></li><li class="L2"><code class="language-`javascript"></code></li><li class="L3"><code class="language-`javascript"><span class="com">//接收数据</span></code></li><li class="L4"><code class="language-`javascript"><span class="kwd">var</span><span class="pln"> G_json </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[],</span><span class="pln">G_Attr </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{},</span><span class="pln">count</span><span class="pun">=</span><span class="lit">0</span><span class="pun">;</span></code></li><li class="L5"><code class="language-`javascript"><span class="kwd">function</span><span class="pln"> </span><span class="typ">AIMap_jsonp</span><span class="pun">(</span><span class="pln">data</span><span class="pun">){</span><span class="com">//默认callback为AIMap_jsonp</span></code></li><li class="L6"><code class="language-`javascript"><span class="pln">    </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">var</span><span class="pln"> i</span><span class="pun">=</span><span class="lit">0</span><span class="pun">,</span><span class="pln">length</span><span class="pun">=</span><span class="pln">data</span><span class="pun">.</span><span class="pln">points</span><span class="pun">.</span><span class="pln">length</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">&lt;</span><span class="pln">length</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++){</span></code></li><li class="L7"><code class="language-`javascript"><span class="pln">        </span><span class="kwd">var</span><span class="pln"> attr </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{};</span></code></li><li class="L8"><code class="language-`javascript"><span class="pln">        attr </span><span class="pun">=</span><span class="pln"> data</span><span class="pun">.</span><span class="pln">points</span><span class="pun">[</span><span class="pln">i</span><span class="pun">];</span></code></li><li class="L9"><code class="language-`javascript"><span class="pln">        G_json</span><span class="pun">.</span><span class="pln">push</span><span class="pun">(</span><span class="pln">attr</span><span class="pun">);</span></code></li><li class="L0"><code class="language-`javascript"><span class="pln">    </span><span class="pun">}</span></code></li><li class="L1"><code class="language-`javascript"><span class="pln">    G_Attr</span><span class="pun">.</span><span class="pln">points </span><span class="pun">=</span><span class="pln"> G_json</span><span class="pun">;</span></code></li><li class="L2"><code class="language-`javascript"><span class="pln">    count</span><span class="pun">--;</span></code></li><li class="L3"><code class="language-`javascript"><span class="pln">    </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">count</span><span class="pun">==</span><span class="lit">0</span><span class="pun">){</span></code></li><li class="L4"><code class="language-`javascript"><span class="pln">        </span><span class="kwd">var</span><span class="pln"> renderOptions </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L5"><code class="language-`javascript"><span class="pln">            </span><span class="com">//标点的一些展示样式，可不写</span></code></li><li class="L6"><code class="language-`javascript"><span class="pln">        </span><span class="pun">};</span></code></li><li class="L7"><code class="language-`javascript"><span class="pln">        </span><span class="com">//转换成标准点坐标</span></code></li><li class="L8"><code class="language-`javascript"><span class="pln">        </span><span class="typ">AIMap</span><span class="pun">.</span><span class="pln">draw</span><span class="pun">.</span><span class="pln">createMarker</span><span class="pun">(</span><span class="pln">myMap</span><span class="pun">,</span><span class="pln"> G_Attr</span><span class="pun">,</span><span class="pln"> renderOptions</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(){</span></code></li><li class="L9"><code class="language-`javascript"><span class="pln">            alert</span><span class="pun">(</span><span class="str">"成功！"</span><span class="pun">)</span></code></li><li class="L0"><code class="language-`javascript"><span class="pln">        </span><span class="pun">});</span></code></li><li class="L1"><code class="language-`javascript"><span class="pln">    </span><span class="pun">}</span></code></li><li class="L2"><code class="language-`javascript"><span class="pun">}</span></code></li></ol></pre>

<div class="md-section-divider"></div>

<h2 id="8显示行政区域">8、显示行政区域</h2>

<div class="md-section-divider"></div>

<h3 id="功能说明-8">功能说明</h3>

<ul>
<li>用户通过点击显示行政区域按钮，选择城市，在地图上显示该城市的行政区域</li>
</ul>

<div class="md-section-divider"></div>

<h3 id="核心代码-7">核心代码</h3>

<div class="md-section-divider"></div>

<pre class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code class="language-`javascript"><span class="com">//调用事例如下：</span></code></li><li class="L1"><code class="language-`javascript"><span class="kwd">var</span><span class="pln"> areaJson </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[];</span></code></li><li class="L2"><code class="language-`javascript"><span class="pln">        </span><span class="kwd">var</span><span class="pln"> tempJson </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[];</span></code></li><li class="L3"><code class="language-`javascript"><span class="pln">        </span><span class="kwd">var</span><span class="pln"> ztempJson </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[];</span></code></li><li class="L4"><code class="language-`javascript"><span class="pln">        </span><span class="kwd">var</span><span class="pln"> bdary </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">AIMap</span><span class="pun">.</span><span class="typ">Boundary</span><span class="pun">();</span></code></li><li class="L5"><code class="language-`javascript"><span class="pln">        </span><span class="kwd">var</span><span class="pln"> value </span><span class="pun">=</span><span class="pln"> prompt</span><span class="pun">(</span><span class="str">'请填写要查找的城市'</span><span class="pun">)||</span><span class="str">"杭州"</span><span class="pun">;</span></code></li><li class="L6"><code class="language-`javascript"><span class="pln">        bdary</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="pln">value</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">rs</span><span class="pun">){</span><span class="pln">       </span><span class="com">//获取行政区域</span></code></li><li class="L7"><code class="language-`javascript"><span class="pln">            myMap</span><span class="pun">.</span><span class="pln">clearOverlays</span><span class="pun">();</span><span class="pln">        </span><span class="com">//清除地图覆盖物</span></code></li><li class="L8"><code class="language-`javascript"><span class="pln">            </span><span class="kwd">var</span><span class="pln"> count </span><span class="pun">=</span><span class="pln"> rs</span><span class="pun">.</span><span class="pln">boundaries</span><span class="pun">.</span><span class="pln">length</span><span class="pun">;</span><span class="pln"> </span><span class="com">//行政区域的点有多少个</span></code></li><li class="L9"><code class="language-`javascript"><span class="pln">            </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">var</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> count</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++){</span></code></li><li class="L0"><code class="language-`javascript"><span class="pln">                </span><span class="kwd">var</span><span class="pln"> ply </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">AIMap</span><span class="pun">.</span><span class="typ">Polygon</span><span class="pun">(</span><span class="pln">rs</span><span class="pun">.</span><span class="pln">boundaries</span><span class="pun">[</span><span class="pln">i</span><span class="pun">],</span><span class="pln"> </span><span class="pun">{</span><span class="pln">strokeWeight</span><span class="pun">:</span><span class="pln"> </span><span class="lit">2</span><span class="pun">,</span><span class="pln"> strokeColor</span><span class="pun">:</span><span class="pln"> </span><span class="str">"#ff0000"</span><span class="pun">});</span><span class="pln"> </span><span class="com">//建立多边形覆盖物</span></code></li><li class="L1"><code class="language-`javascript"><span class="pln">                myMap</span><span class="pun">.</span><span class="pln">addOverlay</span><span class="pun">(</span><span class="pln">ply</span><span class="pun">);</span><span class="pln">  </span><span class="com">//添加覆盖物</span></code></li><li class="L2"><code class="language-`javascript"><span class="pln">                myMap</span><span class="pun">.</span><span class="pln">setViewport</span><span class="pun">(</span><span class="pln">ply</span><span class="pun">.</span><span class="pln">getPath</span><span class="pun">());</span><span class="pln">    </span><span class="com">//调整视野</span></code></li><li class="L3"><code class="language-`javascript"><span class="pln">                tempJson </span><span class="pun">=</span><span class="pln"> rs</span><span class="pun">.</span><span class="pln">boundaries</span><span class="pun">[</span><span class="pln">i</span><span class="pun">].</span><span class="pln">split</span><span class="pun">(</span><span class="str">";"</span><span class="pun">);</span><span class="com">//["120.420324, 30.323932", "120.390411, 30.345232"]</span></code></li><li class="L4"><code class="language-`javascript"></code></li><li class="L5"><code class="language-`javascript"><span class="pln">                </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">var</span><span class="pln"> j</span><span class="pun">=</span><span class="lit">0</span><span class="pun">,</span><span class="pln">length</span><span class="pun">=</span><span class="pln">tempJson</span><span class="pun">.</span><span class="pln">length</span><span class="pun">;</span><span class="pln"> j</span><span class="pun">&lt;</span><span class="pln">length</span><span class="pun">;</span><span class="pln"> j</span><span class="pun">++){</span></code></li><li class="L6"><code class="language-`javascript"><span class="pln">                    ztempJson </span><span class="pun">=</span><span class="pln"> tempJson</span><span class="pun">[</span><span class="pln">j</span><span class="pun">].</span><span class="pln">split</span><span class="pun">(</span><span class="str">","</span><span class="pun">);</span></code></li><li class="L7"><code class="language-`javascript"><span class="pln">                    </span><span class="kwd">var</span><span class="pln"> tempPoint </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{};</span></code></li><li class="L8"><code class="language-`javascript"><span class="pln">                    tempPoint</span><span class="pun">.</span><span class="pln">lng </span><span class="pun">=</span><span class="pln"> ztempJson</span><span class="pun">[</span><span class="lit">0</span><span class="pun">];</span></code></li><li class="L9"><code class="language-`javascript"><span class="pln">                    tempPoint</span><span class="pun">.</span><span class="pln">lat </span><span class="pun">=</span><span class="pln"> ztempJson</span><span class="pun">[</span><span class="lit">1</span><span class="pun">];</span></code></li><li class="L0"><code class="language-`javascript"><span class="pln">                    areaJson</span><span class="pun">.</span><span class="pln">push</span><span class="pun">(</span><span class="pln">tempPoint</span><span class="pun">);</span></code></li><li class="L1"><code class="language-`javascript"><span class="pln">                </span><span class="pun">}</span></code></li><li class="L2"><code class="language-`javascript"><span class="pln">            </span><span class="pun">}</span></code></li><li class="L3"><code class="language-`javascript"></code></li><li class="L4"><code class="language-`javascript"><span class="pln">            </span><span class="com">//初始化画图工具</span></code></li><li class="L5"><code class="language-`javascript"><span class="pln">            </span><span class="kwd">var</span><span class="pln"> drawingManager </span><span class="pun">=</span><span class="pln"> </span><span class="typ">AIMap</span><span class="pun">.</span><span class="pln">draw</span><span class="pun">.</span><span class="pln">createDrawingManager</span><span class="pun">(</span><span class="pln">myMap</span><span class="pun">,</span><span class="str">""</span><span class="pun">);</span></code></li><li class="L6"><code class="language-`javascript"></code></li><li class="L7"><code class="language-`javascript"><span class="pln">            </span><span class="typ">AIMap</span><span class="pun">.</span><span class="pln">draw</span><span class="pun">.</span><span class="pln">drawAreaMarker</span><span class="pun">(</span><span class="pln">myMap</span><span class="pun">,</span><span class="pln">drawingManager</span><span class="pun">,</span><span class="pln">areaJson</span><span class="pun">,</span><span class="kwd">true</span><span class="pun">,</span><span class="lit">0</span><span class="pun">,</span><span class="str">""</span><span class="pun">,</span><span class="kwd">function</span><span class="pun">(</span><span class="pln">data</span><span class="pun">){});</span></code></li><li class="L8"><code class="language-`javascript"><span class="pln">            </span><span class="com">//监听绘图完成事件</span></code></li><li class="L9"><code class="language-`javascript"><span class="pln">            drawingManager</span><span class="pun">.</span><span class="pln">addEventListener</span><span class="pun">(</span><span class="str">'overlaycomplete'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">e</span><span class="pun">){</span></code></li><li class="L0"><code class="language-`javascript"><span class="pln">                </span><span class="com">//标点画区域</span></code></li><li class="L1"><code class="language-`javascript"><span class="pln">                </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">e</span><span class="pun">.</span><span class="pln">drawingMode </span><span class="pun">==</span><span class="pln"> BMAP_DRAWING_MARKER</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L2"><code class="language-`javascript"><span class="pln">                    </span><span class="com">//判断是否超出区域</span></code></li><li class="L3"><code class="language-`javascript"><span class="pln">                    </span><span class="kwd">var</span><span class="pln"> point </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">AIMap</span><span class="pun">.</span><span class="typ">Point</span><span class="pun">(</span><span class="pln">e</span><span class="pun">.</span><span class="pln">overlay</span><span class="pun">.</span><span class="pln">getPosition</span><span class="pun">().</span><span class="pln">lng</span><span class="pun">,</span><span class="pln"> e</span><span class="pun">.</span><span class="pln">overlay</span><span class="pun">.</span><span class="pln">getPosition</span><span class="pun">().</span><span class="pln">lat</span><span class="pun">);</span></code></li><li class="L4"><code class="language-`javascript"></code></li><li class="L5"><code class="language-`javascript"><span class="pln">                    areaJson</span><span class="pun">.</span><span class="pln">push</span><span class="pun">(</span><span class="pln">point</span><span class="pun">);</span></code></li><li class="L6"><code class="language-`javascript"></code></li><li class="L7"><code class="language-`javascript"><span class="pln">                    </span><span class="typ">AIMap</span><span class="pun">.</span><span class="pln">draw</span><span class="pun">.</span><span class="pln">drawAreaMarker</span><span class="pun">(</span><span class="pln">myMap</span><span class="pun">,</span><span class="pln">drawingManager</span><span class="pun">,</span><span class="pln">areaJson</span><span class="pun">,</span><span class="kwd">true</span><span class="pun">,</span><span class="lit">0</span><span class="pun">,</span><span class="str">""</span><span class="pun">,</span><span class="kwd">function</span><span class="pun">(</span><span class="pln">data</span><span class="pun">){</span></code></li><li class="L8"><code class="language-`javascript"><span class="pln">                        </span><span class="com">//data表示返回的区域json</span></code></li><li class="L9"><code class="language-`javascript"><span class="pln">                    </span><span class="pun">});</span></code></li><li class="L0"><code class="language-`javascript"><span class="pln">              </span><span class="pun">}</span></code></li><li class="L1"><code class="language-`javascript"><span class="pln">        </span><span class="pun">});</span></code></li><li class="L2"><code class="language-`javascript"><span class="pun">});</span></code></li></ol></pre>

<div class="md-section-divider"></div>

<h2 id="9计算两点间距离">9、计算两点间距离</h2>

<div class="md-section-divider"></div>

<h3 id="功能说明-9">功能说明</h3>

<ul>
<li>传入两个点的坐标给测距方法，返回两点间的距离,默认单位为米。</li>
</ul>

<div class="md-section-divider"></div>

<h3 id="核心代码-8">核心代码</h3>

<div class="md-section-divider"></div>

<pre class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code class="language-`javascript"><span class="com">//测距方法</span></code></li><li class="L1"><code class="language-`javascript"><span class="typ">AIMap</span><span class="pun">.</span><span class="pln">service</span><span class="pun">.</span><span class="pln">getDistance</span><span class="pun">(</span><span class="pln">map</span><span class="pun">,</span><span class="pln">start_point</span><span class="pun">,</span><span class="pln">end_point</span><span class="pun">){</span></code></li><li class="L2"><code class="language-`javascript"><span class="pln">    </span><span class="kwd">return</span><span class="pln"> map</span><span class="pun">.</span><span class="pln">getDistance</span><span class="pun">(</span><span class="pln">start_point</span><span class="pun">,</span><span class="pln">end_point</span><span class="pun">);</span></code></li><li class="L3"><code class="language-`javascript"><span class="pun">}</span></code></li><li class="L4"><code class="language-`javascript"></code></li><li class="L5"><code class="language-`javascript"><span class="com">//调用方法如下：</span></code></li><li class="L6"><code class="language-`javascript"><span class="kwd">var</span><span class="pln"> point1 </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">AIMap</span><span class="pun">.</span><span class="typ">Point</span><span class="pun">(</span><span class="lit">120.19</span><span class="pun">,</span><span class="lit">30.25</span><span class="pun">);</span></code></li><li class="L7"><code class="language-`javascript"><span class="kwd">var</span><span class="pln"> point2 </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">AIMap</span><span class="pun">.</span><span class="typ">Point</span><span class="pun">(</span><span class="lit">120.10</span><span class="pun">,</span><span class="lit">30.15</span><span class="pun">);</span></code></li><li class="L8"><code class="language-`javascript"><span class="kwd">var</span><span class="pln"> distance </span><span class="pun">=</span><span class="pln"> </span><span class="typ">AIMap</span><span class="pun">.</span><span class="pln">service</span><span class="pun">.</span><span class="pln">getDistance</span><span class="pun">(</span><span class="pln">myMap</span><span class="pun">,</span><span class="pln">point1</span><span class="pun">,</span><span class="pln">point2</span><span class="pun">);</span></code></li><li class="L9"><code class="language-`javascript"><span class="pln">alert</span><span class="pun">(</span><span class="str">"点1（120.19,30.25）和点2（120.10,30.15）之间的直线距离为："</span><span class="pun">+</span><span class="pln">distance</span><span class="pun">+</span><span class="str">"米"</span><span class="pun">);</span></code></li></ol></pre>

<div class="md-section-divider"></div>

<h2 id="10导航">10、导航</h2>

<div class="md-section-divider"></div>

<h3 id="功能说明-10">功能说明</h3>

<ul>
<li>GIS系统提供了多种导航方式，有公交、步行、驾车等,将起点和终点传给导航函数就能返回所查路线。</li>
</ul>

<div class="md-section-divider"></div>

<h3 id="核心代码-9">核心代码</h3>

<div class="md-section-divider"></div>

<pre class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code class="language-`javascript"><span class="com">//驾车导航</span></code></li><li class="L1"><code class="language-`javascript"><span class="kwd">var</span><span class="pln"> driving </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">AIMap</span><span class="pun">.</span><span class="typ">DrivingRoute</span><span class="pun">(</span><span class="pln">myMap</span><span class="pun">,</span><span class="pln"> </span><span class="pun">{</span><span class="pln">renderOptions</span><span class="pun">:{</span><span class="pln">map</span><span class="pun">:</span><span class="pln"> myMap</span><span class="pun">,</span><span class="pln"> autoViewport</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">}});</span></code></li><li class="L2"><code class="language-`javascript"><span class="typ">AIMap</span><span class="pun">.</span><span class="pln">service</span><span class="pun">.</span><span class="pln">drivingNavigate</span><span class="pun">(</span><span class="pln">driving</span><span class="pun">,</span><span class="str">"紫金港商务大厦"</span><span class="pun">,</span><span class="str">"三墩镇"</span><span class="pun">);</span></code></li><li class="L3"><code class="language-`javascript"></code></li><li class="L4"><code class="language-`javascript"><span class="com">//步行导航</span></code></li><li class="L5"><code class="language-`javascript"><span class="kwd">var</span><span class="pln"> walking </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">AIMap</span><span class="pun">.</span><span class="typ">WalkingRoute</span><span class="pun">(</span><span class="pln">myMap</span><span class="pun">,</span><span class="pln">  </span><span class="pun">{</span><span class="pln">renderOptions</span><span class="pun">:{</span><span class="pln">map</span><span class="pun">:</span><span class="pln"> myMap</span><span class="pun">,</span><span class="pln"> autoViewport</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">}});</span></code></li><li class="L6"><code class="language-`javascript"><span class="typ">AIMap</span><span class="pun">.</span><span class="pln">service</span><span class="pun">.</span><span class="pln">walkingNavigate</span><span class="pun">(</span><span class="pln">walking</span><span class="pun">,</span><span class="str">"紫金港商务大厦"</span><span class="pun">,</span><span class="str">"三墩镇"</span><span class="pun">);</span></code></li><li class="L7"><code class="language-`javascript"></code></li><li class="L8"><code class="language-`javascript"><span class="com">//不同策略驾车导航，分为最短时间、最短距离、避开高速</span></code></li><li class="L9"><code class="language-`javascript"><span class="kwd">var</span><span class="pln"> value </span><span class="pun">=</span><span class="pln"> prompt</span><span class="pun">(</span><span class="str">'这是紫金港商务大厦到良渚村的导航，请选择导航方式：'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'0代表最少时间，1代表最短距离，2代表避开高速'</span><span class="pun">);</span><span class="pln">  </span></code></li><li class="L0"><code class="language-`javascript"><span class="typ">AIMap</span><span class="pun">.</span><span class="pln">service</span><span class="pun">.</span><span class="pln">multiNavigate</span><span class="pun">(</span><span class="pln">myMap</span><span class="pun">,</span><span class="str">"紫金港商务大厦"</span><span class="pun">,</span><span class="str">"良渚村"</span><span class="pun">,</span><span class="pln">value</span><span class="pun">?</span><span class="pln">value</span><span class="pun">:</span><span class="str">"0"</span><span class="pun">);</span></code></li><li class="L1"><code class="language-`javascript"></code></li><li class="L2"><code class="language-`javascript"><span class="com">//公交地铁策略导航，分为不乘地铁，0代表最少时间，1代表最少换乘，2代表最少步行</span></code></li><li class="L3"><code class="language-`javascript"><span class="typ">AIMap</span><span class="pun">.</span><span class="pln">service</span><span class="pun">.</span><span class="pln">multiTransitNavigate</span><span class="pun">(</span><span class="pln">myMap</span><span class="pun">,</span><span class="str">"城站火车站"</span><span class="pun">,</span><span class="str">"浙大紫金港商务大厦"</span><span class="pun">,</span><span class="pln">value</span><span class="pun">?</span><span class="pln">value</span><span class="pun">:</span><span class="str">"0"</span><span class="pun">);</span></code></li><li class="L4"><code class="language-`javascript"></code></li><li class="L5"><code class="language-`javascript"><span class="com">//公交导航</span></code></li><li class="L6"><code class="language-`javascript"><span class="typ">AIMap</span><span class="pun">.</span><span class="pln">service</span><span class="pun">.</span><span class="pln">transitNavigate</span><span class="pun">(</span><span class="pln">myMap</span><span class="pun">,</span><span class="str">"紫金港商务大厦"</span><span class="pun">,</span><span class="str">"三墩镇"</span><span class="pun">);</span></code></li></ol></pre>

<div class="md-section-divider"></div>

<h2 id="11周边搜索">11、周边搜索</h2>

<div class="md-section-divider"></div>

<h3 id="功能说明-11">功能说明</h3>

<ul>
<li>用户双击地图，输入关键字，就会在该点周边搜索指定关键字的标记点</li>
</ul>

<div class="md-section-divider"></div>

<h3 id="核心代码-10">核心代码</h3>

<div class="md-section-divider"></div>

<pre class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code class="language-`javascript"><span class="com">//搜索方法，参数是一个包裹搜索信息的json对象，搜索信息包括关键字，地图对象，也可以增加图形对象进行区域内搜索，比如圆形，矩形，或是多边形，如果不传图形对象，则默认按关键字来搜索。</span></code></li><li class="L1"><code class="language-`javascript"><span class="kwd">var</span><span class="pln"> circle </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">AIMap</span><span class="pun">.</span><span class="typ">Circle</span><span class="pun">(</span><span class="pln">e</span><span class="pun">.</span><span class="pln">point</span><span class="pun">,</span><span class="lit">10000.0</span><span class="pun">);</span></code></li><li class="L2"><code class="language-`javascript"><span class="pln">myMap</span><span class="pun">.</span><span class="pln">addOverlay</span><span class="pun">(</span><span class="pln">circle</span><span class="pun">);</span></code></li><li class="L3"><code class="language-`javascript"><span class="kwd">var</span><span class="pln"> data </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L4"><code class="language-`javascript"><span class="pln">    </span><span class="str">"keyword"</span><span class="pun">:</span><span class="str">"营业厅"</span><span class="pun">,</span></code></li><li class="L5"><code class="language-`javascript"><span class="pln">    </span><span class="str">"circle"</span><span class="pun">:</span><span class="pln">circle</span><span class="pun">,</span></code></li><li class="L6"><code class="language-`javascript"><span class="pln">    </span><span class="str">"map"</span><span class="pun">:</span><span class="pln">myMap</span></code></li><li class="L7"><code class="language-`javascript"><span class="pun">}</span></code></li><li class="L8"><code class="language-`javascript"><span class="typ">AIMap</span><span class="pun">.</span><span class="pln">service</span><span class="pun">.</span><span class="pln">search</span><span class="pun">(</span><span class="pln">data</span><span class="pun">);</span></code></li><li class="L9"><code class="language-`javascript"></code></li><li class="L0"><code class="language-`javascript"><span class="com">//调用事例如下：</span></code></li><li class="L1"><code class="language-`javascript"><span class="pln">myMap</span><span class="pun">.</span><span class="pln">addEventListener</span><span class="pun">(</span><span class="str">"dblclick"</span><span class="pun">,</span><span class="kwd">function</span><span class="pun">(</span><span class="pln">e</span><span class="pun">){</span></code></li><li class="L2"><code class="language-`javascript"><span class="pln">    </span><span class="typ">AIMap</span><span class="pun">.</span><span class="pln">service</span><span class="pun">.</span><span class="pln">clearAll</span><span class="pun">(</span><span class="pln">myMap</span><span class="pun">);</span></code></li><li class="L3"><code class="language-`javascript"><span class="pln">    </span><span class="kwd">var</span><span class="pln"> marker </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">AIMap</span><span class="pun">.</span><span class="typ">Marker</span><span class="pun">(</span><span class="pln">e</span><span class="pun">.</span><span class="pln">point</span><span class="pun">);</span></code></li><li class="L4"><code class="language-`javascript"><span class="pln">    myMap</span><span class="pun">.</span><span class="pln">addOverlay</span><span class="pun">(</span><span class="pln">marker</span><span class="pun">);</span></code></li><li class="L5"><code class="language-`javascript"><span class="pln">    </span><span class="kwd">var</span><span class="pln"> value </span><span class="pun">=</span><span class="pln"> prompt</span><span class="pun">(</span><span class="str">"请输入搜索标记点的名称关键字"</span><span class="pun">);</span></code></li><li class="L6"><code class="language-`javascript"><span class="pln">    </span><span class="kwd">var</span><span class="pln"> circle </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">AIMap</span><span class="pun">.</span><span class="typ">Circle</span><span class="pun">(</span><span class="pln">e</span><span class="pun">.</span><span class="pln">point</span><span class="pun">,</span><span class="lit">10000.0</span><span class="pun">);</span></code></li><li class="L7"><code class="language-`javascript"><span class="pln">    myMap</span><span class="pun">.</span><span class="pln">addOverlay</span><span class="pun">(</span><span class="pln">circle</span><span class="pun">);</span></code></li><li class="L8"><code class="language-`javascript"><span class="pln">    </span><span class="kwd">var</span><span class="pln"> data </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L9"><code class="language-`javascript"><span class="pln">        </span><span class="str">"keyword"</span><span class="pun">:</span><span class="pln">value</span><span class="pun">,</span></code></li><li class="L0"><code class="language-`javascript"><span class="pln">        </span><span class="str">"circle"</span><span class="pun">:</span><span class="pln">circle</span><span class="pun">,</span></code></li><li class="L1"><code class="language-`javascript"><span class="pln">        </span><span class="str">"map"</span><span class="pun">:</span><span class="pln">myMap</span></code></li><li class="L2"><code class="language-`javascript"><span class="pln">    </span><span class="pun">}</span></code></li><li class="L3"><code class="language-`javascript"><span class="pln">    </span><span class="typ">AIMap</span><span class="pun">.</span><span class="pln">service</span><span class="pun">.</span><span class="pln">search</span><span class="pun">(</span><span class="pln">data</span><span class="pun">);</span></code></li><li class="L4"><code class="language-`javascript"><span class="pun">})</span></code></li></ol></pre>

<div class="md-section-divider"></div>

<h2 id="12自定义信息窗口">12、自定义信息窗口</h2>

<div class="md-section-divider"></div>

<h3 id="功能说明-12">功能说明</h3>

<ul>
<li>用户可以对信息窗口进行编辑</li>
</ul>

<div class="md-section-divider"></div>

<h3 id="核心代码-11">核心代码</h3>

<div class="md-section-divider"></div>

<pre class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code class="language-`javascript"><span class="com">//创建信息窗口方法,需传入地图对象，标记点坐标，绘制信息窗的html,可以在回调函数中对标点和信息窗进行操作</span></code></li><li class="L1"><code class="language-`javascript"><span class="typ">AIMap</span><span class="pun">.</span><span class="pln">draw</span><span class="pun">.</span><span class="pln">createInfoWindow</span><span class="pun">(</span><span class="pln">myMap</span><span class="pun">,</span><span class="pln"> json</span><span class="pun">.</span><span class="pln">points</span><span class="pun">[</span><span class="pln">i</span><span class="pun">],</span><span class="pln"> html</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">marker</span><span class="pun">,</span><span class="pln"> infoWindow</span><span class="pun">){</span></code></li><li class="L2"><code class="language-`javascript"></code></li><li class="L3"><code class="language-`javascript"><span class="pun">})</span></code></li><li class="L4"><code class="language-`javascript"><span class="com">//调用事例如下：</span></code></li><li class="L5"><code class="language-`javascript"><span class="typ">AIMap</span><span class="pun">.</span><span class="pln">ajax</span><span class="pun">.</span><span class="typ">AjaxJson</span><span class="pun">(</span><span class="str">"res/data4Ext/point.json?1=1"</span><span class="pun">,</span><span class="str">''</span><span class="pun">,</span><span class="kwd">function</span><span class="pun">(</span><span class="pln">state</span><span class="pun">,</span><span class="pln">json</span><span class="pun">){</span></code></li><li class="L6"><code class="language-`javascript"><span class="pln">  </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">state</span><span class="pun">==</span><span class="str">'success'</span><span class="pun">){</span></code></li><li class="L7"><code class="language-`javascript"><span class="pln">      </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">json</span><span class="pun">&amp;&amp;</span><span class="pln">json</span><span class="pun">.</span><span class="pln">returnCode</span><span class="pun">==</span><span class="str">'1'</span><span class="pun">){</span></code></li><li class="L8"><code class="language-`javascript"><span class="pln">        </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">var</span><span class="pln"> i</span><span class="pun">=</span><span class="lit">0</span><span class="pun">,</span><span class="pln">length</span><span class="pun">=</span><span class="pln">json</span><span class="pun">.</span><span class="pln">points</span><span class="pun">.</span><span class="pln">length</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">&lt;</span><span class="pln">length</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++){</span></code></li><li class="L9"><code class="language-`javascript"><span class="pln">            </span><span class="kwd">var</span><span class="pln"> html </span><span class="pun">=</span><span class="pln"> </span></code></li><li class="L0"><code class="language-`javascript"><span class="pln">                </span><span class="str">"&lt;h4 style='margin:0 0 5px 0;padding:0.2em 0'&gt;"</span><span class="pun">+</span><span class="pln">json</span><span class="pun">.</span><span class="pln">points</span><span class="pun">[</span><span class="pln">i</span><span class="pun">].</span><span class="pln">title</span><span class="pun">+</span></code></li><li class="L1"><code class="language-`javascript"><span class="pln">                </span><span class="str">"&lt;/h4&gt;&lt;img style='float:right;margin:4px' id='imgDemo' src='http://app.baidu.com/map/images/tiananmen.jpg' width='139' height='104' title='"</span><span class="pun">+</span><span class="pln">json</span><span class="pun">.</span><span class="pln">points</span><span class="pun">[</span><span class="pln">i</span><span class="pun">].</span><span class="pln">title</span><span class="pun">+</span></code></li><li class="L2"><code class="language-`javascript"><span class="pln">                </span><span class="str">"'/&gt;&lt;p style='margin:0;line-height:1.5;font-size:13px;text-indent:2em'&gt;"</span><span class="pun">+</span><span class="pln">json</span><span class="pun">.</span><span class="pln">points</span><span class="pun">[</span><span class="pln">i</span><span class="pun">].</span><span class="pln">lng</span><span class="pun">+</span></code></li><li class="L3"><code class="language-`javascript"><span class="pln">                </span><span class="str">"&lt;/p&gt;&lt;/div&gt;"</span><span class="pun">;</span></code></li><li class="L4"><code class="language-`javascript"><span class="pln">            </span><span class="typ">AIMap</span><span class="pun">.</span><span class="pln">draw</span><span class="pun">.</span><span class="pln">createInfoWindow</span><span class="pun">(</span><span class="pln">myMap</span><span class="pun">,</span><span class="pln"> json</span><span class="pun">.</span><span class="pln">points</span><span class="pun">[</span><span class="pln">i</span><span class="pun">],</span><span class="pln"> html</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">marker</span><span class="pun">,</span><span class="pln"> infoWindow</span><span class="pun">){</span><span class="com">//触发的是标记点的点击事件</span></code></li><li class="L5"><code class="language-`javascript"><span class="pln">                </span><span class="kwd">var</span><span class="pln"> zhtml </span><span class="pun">=</span><span class="pln"> </span><span class="str">"你好！"</span><span class="pun">;</span></code></li><li class="L6"><code class="language-`javascript"><span class="pln">                infoWindow</span><span class="pun">.</span><span class="pln">setContent</span><span class="pun">(</span><span class="pln">zhtml</span><span class="pun">+</span><span class="pln">html</span><span class="pun">+</span><span class="pln">zhtml</span><span class="pun">);</span></code></li><li class="L7"><code class="language-`javascript"><span class="pln">                marker</span><span class="pun">.</span><span class="pln">openInfoWindow</span><span class="pun">(</span><span class="pln">infoWindow</span><span class="pun">);</span></code></li><li class="L8"><code class="language-`javascript"><span class="pln">            </span><span class="pun">});</span></code></li><li class="L9"><code class="language-`javascript"><span class="pln">        </span><span class="pun">}</span></code></li><li class="L0"><code class="language-`javascript"><span class="pln">      </span><span class="pun">}</span></code></li><li class="L1"><code class="language-`javascript"><span class="pln">  </span><span class="pun">}</span></code></li><li class="L2"><code class="language-`javascript"><span class="pun">});</span></code></li></ol></pre>

<div class="md-section-divider"></div>

<h2 id="13根据应用显示树">13、根据应用显示树</h2>

<div class="md-section-divider"></div>

<h3 id="功能说明-13">功能说明</h3>

<ul>
<li>选择应用显示其所绑定的树，选中其中一颗树并点击树节点，可以显示该节点所绑定的区域和标记点</li>
<li>注意1：此方法需要引入jquery.js和jquery.ztree.js用于生成组织树；</li>
<li>注意2：由于框架问题，后台返回的json信息不是标准的json格式，需要去对数据进行转换（引入json2.js）。</li>
</ul>

<div class="md-section-divider"></div>

<h3 id="核心代码-12">核心代码</h3>

<div class="md-section-divider"></div>

<pre class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code class="language-`javascript"><span class="com">//创建树的方法,obj代表包裹树的div对象，json表示ztree的数据源,callback返回的是event对象，包裹树的容器ID，以及树节点对象。</span></code></li><li class="L1"><code class="language-`javascript"><span class="typ">AIMap</span><span class="pun">.</span><span class="pln">draw</span><span class="pun">.</span><span class="pln">drawZtree</span><span class="pun">(</span><span class="pln">obj</span><span class="pun">,</span><span class="pln">json</span><span class="pun">,</span><span class="kwd">function</span><span class="pun">(</span><span class="pln">e</span><span class="pun">,</span><span class="pln">treeId</span><span class="pun">,</span><span class="pln">treeNode</span><span class="pun">){</span></code></li><li class="L2"><code class="language-`javascript"></code></li><li class="L3"><code class="language-`javascript"><span class="pun">})</span></code></li><li class="L4"><code class="language-`javascript"></code></li><li class="L5"><code class="language-`javascript"><span class="com">//调用事例如下：</span></code></li><li class="L6"><code class="language-`javascript"><span class="kwd">var</span><span class="pln"> value </span><span class="pun">=</span><span class="pln"> prompt</span><span class="pun">(</span><span class="str">"请选择应用：0代表营业厅系统，1代表ESOP"</span><span class="pun">);</span></code></li><li class="L7"><code class="language-`javascript"><span class="kwd">var</span><span class="pln"> Z_json</span><span class="pun">,</span><span class="pln">zFlag</span><span class="pun">=</span><span class="lit">1</span><span class="pun">;</span></code></li><li class="L8"><code class="language-`javascript"><span class="kwd">var</span><span class="pln"> parentJson</span><span class="pun">;</span><span class="com">//父区域</span></code></li><li class="L9"><code class="language-`javascript"><span class="kwd">var</span><span class="pln"> jsonSelf</span><span class="pun">;</span><span class="com">//自己区域</span></code></li><li class="L0"><code class="language-`javascript"><span class="kwd">var</span><span class="pln"> siblingsJson </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[];</span><span class="com">//同级区域</span></code></li><li class="L1"><code class="language-`javascript"><span class="kwd">var</span><span class="pln"> type </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="com">//根据drawingModes判断，当为0或者false的时候，不需要考虑超出区域；当传1或者true的时候校验</span></code></li><li class="L2"><code class="language-`javascript"><span class="kwd">var</span><span class="pln"> areaMarker </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[];</span><span class="com">//标记点数组</span></code></li><li class="L3"><code class="language-`javascript"><span class="kwd">var</span><span class="pln"> rootId </span><span class="pun">=</span><span class="pln"> </span><span class="str">""</span><span class="pun">;</span></code></li><li class="L4"><code class="language-`javascript"><span class="kwd">var</span><span class="pln"> rootFlag </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">;</span></code></li><li class="L5"><code class="language-`javascript"><span class="com">//初始化树</span></code></li><li class="L6"><code class="language-`javascript"><span class="pln">value </span><span class="pun">=</span><span class="pln"> parseInt</span><span class="pun">(</span><span class="pln">value</span><span class="pun">);</span></code></li><li class="L7"><code class="language-`javascript"><span class="kwd">var</span><span class="pln"> appids </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="lit">7</span><span class="pun">,</span><span class="lit">9</span><span class="pun">];</span></code></li><li class="L8"><code class="language-`javascript"><span class="kwd">var</span><span class="pln"> appid</span><span class="pun">=</span><span class="pln">appids</span><span class="pun">[</span><span class="pln">parseInt</span><span class="pun">(</span><span class="pln">value</span><span class="pun">)];</span></code></li><li class="L9"><code class="language-`javascript"><span class="com">//AIMap.ajax.AjaxJson("res/data/treeAppId.json?1=1","appId="+appid,function(state,json){</span></code></li><li class="L0"><code class="language-`javascript"><span class="typ">AIMap</span><span class="pun">.</span><span class="pln">ajax</span><span class="pun">.</span><span class="typ">AjaxJson</span><span class="pun">(</span><span class="str">"hz/sdkaction/common?uid=getTreeByAppId"</span><span class="pun">,</span><span class="str">"appId="</span><span class="pun">+</span><span class="pln">appid</span><span class="pun">,</span><span class="kwd">function</span><span class="pun">(</span><span class="pln">state</span><span class="pun">,</span><span class="pln">json</span><span class="pun">){</span><span class="com">//生成组织树的下拉框</span></code></li><li class="L1"><code class="language-`javascript"><span class="pln">    </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">state</span><span class="pun">==</span><span class="str">'success'</span><span class="pun">){</span></code></li><li class="L2"><code class="language-`javascript"><span class="pln">        </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">json</span><span class="pun">&amp;&amp;</span><span class="pln">json</span><span class="pun">.</span><span class="pln">returnCode</span><span class="pun">==</span><span class="str">'1'</span><span class="pun">){</span></code></li><li class="L3"><code class="language-`javascript"><span class="pln">            $</span><span class="pun">(</span><span class="str">"#createSelect"</span><span class="pun">).</span><span class="pln">show</span><span class="pun">();</span></code></li><li class="L4"><code class="language-`javascript"><span class="pln">            $</span><span class="pun">(</span><span class="str">"#createSelect option"</span><span class="pun">).</span><span class="pln">remove</span><span class="pun">();</span></code></li><li class="L5"><code class="language-`javascript"><span class="pln">            $</span><span class="pun">(</span><span class="str">"#createSelect"</span><span class="pun">).</span><span class="pln">append</span><span class="pun">(</span><span class="str">"&lt;option&gt;请选择&lt;/option&gt;"</span><span class="pun">);</span></code></li><li class="L6"><code class="language-`javascript"><span class="pln">            </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">var</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> json</span><span class="pun">.</span><span class="pln">rows</span><span class="pun">.</span><span class="pln">length</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++){</span></code></li><li class="L7"><code class="language-`javascript"><span class="pln">                $</span><span class="pun">(</span><span class="str">"#createSelect"</span><span class="pun">).</span><span class="pln">append</span><span class="pun">(</span><span class="str">"&lt;option value='"</span><span class="pun">+</span><span class="pln">json</span><span class="pun">.</span><span class="pln">rows</span><span class="pun">[</span><span class="pln">i</span><span class="pun">].</span><span class="pln">nodeId</span><span class="pun">+</span><span class="str">"'&gt;"</span><span class="pun">+</span><span class="pln">json</span><span class="pun">.</span><span class="pln">rows</span><span class="pun">[</span><span class="pln">i</span><span class="pun">].</span><span class="pln">nodeName</span><span class="pun">+</span><span class="str">"&lt;/option&gt;"</span><span class="pun">);</span></code></li><li class="L8"><code class="language-`javascript"><span class="pln">            </span><span class="pun">}</span></code></li><li class="L9"><code class="language-`javascript"><span class="pln">            $</span><span class="pun">(</span><span class="str">"#createSelect"</span><span class="pun">).</span><span class="pln">change</span><span class="pun">(</span><span class="kwd">function</span><span class="pun">(){</span></code></li><li class="L0"><code class="language-`javascript"><span class="pln">                </span><span class="kwd">var</span><span class="pln"> rootid </span><span class="pun">=</span><span class="pln"> $</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">).</span><span class="pln">val</span><span class="pun">();</span></code></li><li class="L1"><code class="language-`javascript"><span class="pln">                </span><span class="typ">AIMap</span><span class="pun">.</span><span class="pln">ajax</span><span class="pun">.</span><span class="typ">AjaxJson</span><span class="pun">(</span><span class="str">"hz/sdkaction/common?uid=getTreeByRootId"</span><span class="pun">,</span><span class="str">"appid="</span><span class="pun">+</span><span class="pln">appid</span><span class="pun">+</span><span class="str">"&amp;rootid="</span><span class="pun">+</span><span class="pln">rootid</span><span class="pun">,</span><span class="kwd">function</span><span class="pun">(</span><span class="pln">state</span><span class="pun">,</span><span class="pln">json</span><span class="pun">){</span></code></li><li class="L2"><code class="language-`javascript"><span class="pln">                        </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">state</span><span class="pun">==</span><span class="str">'success'</span><span class="pun">){</span></code></li><li class="L3"><code class="language-`javascript"><span class="pln">                            </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">json</span><span class="pun">&amp;&amp;</span><span class="pln">json</span><span class="pun">.</span><span class="pln">returnCode</span><span class="pun">==</span><span class="str">'1'</span><span class="pun">){</span></code></li><li class="L4"><code class="language-`javascript"><span class="pln">                                </span><span class="typ">AIMap</span><span class="pun">.</span><span class="pln">draw</span><span class="pun">.</span><span class="pln">drawZtree</span><span class="pun">(</span><span class="pln">$</span><span class="pun">(</span><span class="str">"#J_tree"</span><span class="pun">),</span><span class="pln"> json</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">e</span><span class="pun">,</span><span class="pln"> treeId</span><span class="pun">,</span><span class="pln"> treeNode</span><span class="pun">){</span></code></li><li class="L5"><code class="language-`javascript"><span class="pln">                                    </span><span class="typ">AIMap</span><span class="pun">.</span><span class="pln">service</span><span class="pun">.</span><span class="pln">clearAll</span><span class="pun">(</span><span class="pln">myMap</span><span class="pun">);</span><span class="pln"> </span></code></li><li class="L6"><code class="language-`javascript"></code></li><li class="L7"><code class="language-`javascript"><span class="pln">                                    </span><span class="com">//显示树节点下绑定的标记点</span></code></li><li class="L8"><code class="language-`javascript"><span class="pln">                                    </span><span class="typ">AIMap</span><span class="pun">.</span><span class="pln">ajax</span><span class="pun">.</span><span class="typ">AjaxJson</span><span class="pun">(</span><span class="str">"hz/sdkaction/common?uid=getPointByTreeNodeId"</span><span class="pun">,</span><span class="str">"appid="</span><span class="pun">+</span><span class="pln">appid</span><span class="pun">+</span><span class="str">"&amp;treeId="</span><span class="pun">+</span><span class="pln">treeNode</span><span class="pun">.</span><span class="pln">id</span><span class="pun">,</span><span class="kwd">function</span><span class="pun">(</span><span class="pln">state</span><span class="pun">,</span><span class="pln">json</span><span class="pun">){</span></code></li><li class="L9"><code class="language-`javascript"><span class="pln">                                        </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">state</span><span class="pun">==</span><span class="str">'success'</span><span class="pun">){</span></code></li><li class="L0"><code class="language-`javascript"><span class="pln">                                            </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">json</span><span class="pun">&amp;&amp;</span><span class="pln">json</span><span class="pun">.</span><span class="pln">returnCode</span><span class="pun">==</span><span class="str">'1'</span><span class="pun">&amp;&amp;</span><span class="pln">json</span><span class="pun">.</span><span class="pln">points</span><span class="pun">.</span><span class="pln">length</span><span class="pun">&gt;</span><span class="lit">0</span><span class="pun">){</span></code></li><li class="L1"><code class="language-`javascript"><span class="pln">                                                </span><span class="typ">AIMap</span><span class="pun">.</span><span class="pln">draw</span><span class="pun">.</span><span class="pln">createMarker</span><span class="pun">(</span><span class="pln">myMap</span><span class="pun">,</span><span class="pln">json</span><span class="pun">,</span><span class="str">""</span><span class="pun">,</span><span class="str">""</span><span class="pun">);</span></code></li><li class="L2"><code class="language-`javascript"><span class="pln">                                            </span><span class="pun">}</span></code></li><li class="L3"><code class="language-`javascript"><span class="pln">                                        </span><span class="pun">}</span></code></li><li class="L4"><code class="language-`javascript"><span class="pln">                                    </span><span class="pun">});</span></code></li><li class="L5"><code class="language-`javascript"></code></li><li class="L6"><code class="language-`javascript"><span class="pln">                                    </span><span class="com">//显示树节点下绑定的区域</span></code></li><li class="L7"><code class="language-`javascript"><span class="pln">                                     $</span><span class="pun">.</span><span class="typ">PostJson</span><span class="pun">(</span><span class="str">"hz/sdkaction/common?uid=getAreaByTreeNodeId"</span><span class="pun">,</span><span class="str">"appid="</span><span class="pun">+</span><span class="pln">appid</span><span class="pun">+</span><span class="str">"&amp;treeId="</span><span class="pun">+</span><span class="pln">treeNode</span><span class="pun">.</span><span class="pln">id</span><span class="pun">,</span><span class="kwd">function</span><span class="pun">(</span><span class="pln">state</span><span class="pun">,</span><span class="pln">json</span><span class="pun">){</span></code></li><li class="L8"><code class="language-`javascript"><span class="pln">                                    </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">state</span><span class="pun">==</span><span class="str">"success"</span><span class="pun">){</span></code></li><li class="L9"><code class="language-`javascript"><span class="pln">                                        </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">json</span><span class="pun">&amp;&amp;</span><span class="pln">json</span><span class="pun">.</span><span class="pln">returnCode</span><span class="pun">==</span><span class="str">"1"</span><span class="pun">){</span></code></li><li class="L0"><code class="language-`javascript"><span class="pln">                                            </span><span class="kwd">var</span><span class="pln"> parentArea </span><span class="pun">=</span><span class="pln"> </span><span class="str">""</span><span class="pun">;</span></code></li><li class="L1"><code class="language-`javascript"><span class="pln">                                            </span><span class="kwd">var</span><span class="pln"> center </span><span class="pun">=</span><span class="pln"> JSON</span><span class="pun">.</span><span class="pln">parse</span><span class="pun">(</span><span class="pln">json</span><span class="pun">.</span><span class="pln">center</span><span class="pun">);</span><span class="com">//转换为标准json对象</span></code></li><li class="L2"><code class="language-`javascript"><span class="pln">                                            </span><span class="kwd">var</span><span class="pln"> point </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">AIMap</span><span class="pun">.</span><span class="typ">Point</span><span class="pun">(</span><span class="pln">center</span><span class="pun">.</span><span class="pln">lng</span><span class="pun">,</span><span class="pln">center</span><span class="pun">.</span><span class="pln">lat</span><span class="pun">);</span></code></li><li class="L3"><code class="language-`javascript"><span class="pln">                                            myMap</span><span class="pun">.</span><span class="pln">centerAndZoom</span><span class="pun">(</span><span class="pln">point</span><span class="pun">,</span><span class="pln"> </span><span class="lit">13</span><span class="pun">);</span><span class="pln"> </span></code></li><li class="L4"><code class="language-`javascript"><span class="pln">                                            </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">json</span><span class="pun">.</span><span class="pln">parentJson</span><span class="pun">){</span><span class="com">//获取父区域</span></code></li><li class="L5"><code class="language-`javascript"><span class="pln">                                                parentArea </span><span class="pun">=</span><span class="pln"> JSON</span><span class="pun">.</span><span class="pln">parse</span><span class="pun">(</span><span class="pln">json</span><span class="pun">.</span><span class="pln">parentJson</span><span class="pun">).</span><span class="pln">rows</span><span class="pun">;</span></code></li><li class="L6"><code class="language-`javascript"><span class="pln">                                            </span><span class="pun">}</span></code></li><li class="L7"><code class="language-`javascript"><span class="pln">                                            </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">parentArea</span><span class="pun">){</span></code></li><li class="L8"><code class="language-`javascript"><span class="pln">                                                </span><span class="kwd">var</span><span class="pln"> param </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L9"><code class="language-`javascript"><span class="pln">                                                    </span><span class="str">"strokeOpacity"</span><span class="pun">:</span><span class="pln"> </span><span class="str">".4"</span><span class="pun">,</span></code></li><li class="L0"><code class="language-`javascript"><span class="pln">                                                    </span><span class="str">"fillOpacity"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"1"</span></code></li><li class="L1"><code class="language-`javascript"><span class="pln">                                                </span><span class="pun">}</span></code></li><li class="L2"><code class="language-`javascript"><span class="pln">                                                parentArea</span><span class="pun">.</span><span class="pln">param </span><span class="pun">=</span><span class="pln"> param</span><span class="pun">;</span></code></li><li class="L3"><code class="language-`javascript"><span class="pln">                                                parentJson </span><span class="pun">=</span><span class="pln"> </span><span class="typ">AIMap</span><span class="pun">.</span><span class="pln">draw</span><span class="pun">.</span><span class="pln">drawShape</span><span class="pun">(</span><span class="pln">myMap</span><span class="pun">,</span><span class="pln">parentArea</span><span class="pun">,</span><span class="kwd">true</span><span class="pun">);</span><span class="com">//父区域绘制</span></code></li><li class="L4"><code class="language-`javascript"><span class="pln">                                            </span><span class="pun">}</span></code></li><li class="L5"><code class="language-`javascript"><span class="pln">                                            </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">json</span><span class="pun">.</span><span class="pln">selfJson</span><span class="pun">){</span><span class="com">//获取自己区域</span></code></li><li class="L6"><code class="language-`javascript"><span class="pln">                                               jsonSelf </span><span class="pun">=</span><span class="pln"> JSON</span><span class="pun">.</span><span class="pln">parse</span><span class="pun">(</span><span class="pln">json</span><span class="pun">.</span><span class="pln">selfJson</span><span class="pun">).</span><span class="pln">rows</span><span class="pun">;</span></code></li><li class="L7"><code class="language-`javascript"><span class="pln">                                               Z_json </span><span class="pun">=</span><span class="pln"> jsonSelf</span><span class="pun">;</span></code></li><li class="L8"><code class="language-`javascript"><span class="pln">                                            </span><span class="pun">}</span></code></li><li class="L9"><code class="language-`javascript"><span class="pln">                                            </span><span class="kwd">var</span><span class="pln"> areaJson </span><span class="pun">=</span><span class="pln"> json</span><span class="pun">.</span><span class="pln">rows</span><span class="pun">;</span></code></li><li class="L0"><code class="language-`javascript"><span class="pln">                                            siblingsJson</span><span class="pun">.</span><span class="pln">length </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span></code></li><li class="L1"><code class="language-`javascript"><span class="pln">                                            </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">var</span><span class="pln"> i</span><span class="pun">=</span><span class="lit">0</span><span class="pun">,</span><span class="pln">length</span><span class="pun">=</span><span class="pln">areaJson</span><span class="pun">.</span><span class="pln">length</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">&lt;</span><span class="pln">length</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++){</span><span class="com">//获取相邻同级区域</span></code></li><li class="L2"><code class="language-`javascript"><span class="pln">                                                </span><span class="kwd">var</span><span class="pln"> sibJson </span><span class="pun">=</span><span class="pln"> JSON</span><span class="pun">.</span><span class="pln">parse</span><span class="pun">(</span><span class="pln">areaJson</span><span class="pun">[</span><span class="pln">i</span><span class="pun">].</span><span class="pln">areaJson</span><span class="pun">).</span><span class="pln">rows</span><span class="pun">;</span></code></li><li class="L3"><code class="language-`javascript"><span class="pln">                                                </span><span class="kwd">var</span><span class="pln"> param </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L4"><code class="language-`javascript"><span class="pln">                                                    </span><span class="str">"strokeOpacity"</span><span class="pun">:</span><span class="pln"> </span><span class="str">".4"</span></code></li><li class="L5"><code class="language-`javascript"><span class="pln">                                                </span><span class="pun">}</span></code></li><li class="L6"><code class="language-`javascript"><span class="pln">                                                sibJson</span><span class="pun">.</span><span class="pln">param </span><span class="pun">=</span><span class="pln"> param</span><span class="pun">;</span></code></li><li class="L7"><code class="language-`javascript"><span class="pln">                                                siblingsJson</span><span class="pun">.</span><span class="pln">push</span><span class="pun">(</span><span class="typ">AIMap</span><span class="pun">.</span><span class="pln">draw</span><span class="pun">.</span><span class="pln">drawShape</span><span class="pun">(</span><span class="pln">myMap</span><span class="pun">,</span><span class="pln">sibJson</span><span class="pun">,</span><span class="kwd">true</span><span class="pun">));</span></code></li><li class="L8"><code class="language-`javascript"><span class="pln">                                            </span><span class="pun">}</span></code></li><li class="L9"><code class="language-`javascript"></code></li><li class="L0"><code class="language-`javascript"><span class="pln">                                            areaMarker</span><span class="pun">.</span><span class="pln">length </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span></code></li><li class="L1"><code class="language-`javascript"><span class="pln">                                            </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">jsonSelf</span><span class="pun">){</span></code></li><li class="L2"><code class="language-`javascript"><span class="pln">                                                areaMarker </span><span class="pun">=</span><span class="pln"> jsonSelf</span><span class="pun">.</span><span class="pln">points</span><span class="pun">;</span></code></li><li class="L3"><code class="language-`javascript"><span class="pln">                                                </span><span class="typ">AIMap</span><span class="pun">.</span><span class="pln">draw</span><span class="pun">.</span><span class="pln">drawShape</span><span class="pun">(</span><span class="pln">myMap</span><span class="pun">,</span><span class="pln">jsonSelf</span><span class="pun">,</span><span class="kwd">false</span><span class="pun">);</span><span class="com">//子区域绘制</span></code></li><li class="L4"><code class="language-`javascript"><span class="pln">                                            </span><span class="pun">}</span></code></li><li class="L5"><code class="language-`javascript"><span class="pln">                                        </span><span class="pun">}</span><span class="kwd">else</span><span class="pun">{</span></code></li><li class="L6"><code class="language-`javascript"><span class="pln">                                            alert</span><span class="pun">(</span><span class="pln">json</span><span class="pun">.</span><span class="pln">returnMessage</span><span class="pun">||</span><span class="str">"修改失败！"</span><span class="pun">);</span></code></li><li class="L7"><code class="language-`javascript"><span class="pln">                                        </span><span class="pun">}</span></code></li><li class="L8"><code class="language-`javascript"><span class="pln">                                    </span><span class="pun">}</span><span class="kwd">else</span><span class="pun">{</span></code></li><li class="L9"><code class="language-`javascript"><span class="pln">                                        alert</span><span class="pun">(</span><span class="str">"系统错误！"</span><span class="pun">);</span></code></li><li class="L0"><code class="language-`javascript"><span class="pln">                                    </span><span class="pun">}</span></code></li><li class="L1"><code class="language-`javascript"><span class="pln">                                </span><span class="pun">});</span><span class="pln"> </span></code></li><li class="L2"><code class="language-`javascript"><span class="pln">                            </span><span class="pun">}</span><span class="pln"> </span><span class="pun">);</span><span class="pln"> </span></code></li><li class="L3"><code class="language-`javascript"><span class="pln">                        </span><span class="pun">}</span></code></li><li class="L4"><code class="language-`javascript"><span class="pln">                    </span><span class="pun">}</span></code></li><li class="L5"><code class="language-`javascript"><span class="pln">                </span><span class="pun">})</span></code></li><li class="L6"><code class="language-`javascript"><span class="pln">            </span><span class="pun">})</span></code></li><li class="L7"><code class="language-`javascript"><span class="pln">        </span><span class="pun">}</span></code></li><li class="L8"><code class="language-`javascript"><span class="pln">    </span><span class="pun">}</span></code></li><li class="L9"><code class="language-`javascript"><span class="pun">});</span></code></li></ol></pre>

<div class="md-section-divider"></div>

<h2 id="14ajax">14、Ajax</h2>

<div class="md-section-divider"></div>

<h3 id="功能说明-14">功能说明</h3>

<ul>
<li>GIS系统提供了两种Ajax请求，一种是原生Ajax非跨域请求，而另一种是Ajax跨域请求</li>
</ul>

<div class="md-section-divider"></div>

<h3 id="核心代码-13">核心代码</h3>

<div class="md-section-divider"></div>

<pre class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code class="language-`javascript"><span class="com">//原生Ajax非跨域请求方法</span></code></li><li class="L1"><code class="language-`javascript"><span class="typ">AIMap</span><span class="pun">.</span><span class="pln">ajax</span><span class="pun">.</span><span class="typ">AjaxJson</span><span class="pun">(</span><span class="pln">url</span><span class="pun">,</span><span class="pln"> datas</span><span class="pun">,</span><span class="pln"> callback</span><span class="pun">)</span></code></li><li class="L2"><code class="language-`javascript"></code></li><li class="L3"><code class="language-`javascript"><span class="com">//Ajax跨域请求方法,datas中包含回调方法，缺省为AIMap_jsonp</span></code></li><li class="L4"><code class="language-`javascript"><span class="typ">AIMap</span><span class="pun">.</span><span class="pln">ajax</span><span class="pun">.</span><span class="typ">AjaxJson</span><span class="pun">(</span><span class="pln">url</span><span class="pun">,</span><span class="pln"> datas</span><span class="pun">)</span></code></li></ol></pre>

<div class="md-section-divider"></div>

<h2 id="15其他方法">15、其他方法</h2>

<ul>
<li>异步加载脚本 <br>
<ul><li>功能说明：用于异步加载脚本，通常用于当百度地图js加载完成后，需要使用到百度地图工具类脚本，例如绘制脚本的时候使用</li>
<li>核心代码：</li></ul></li>
</ul>

<div class="md-section-divider"></div>

<pre class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code><span class="kwd">function</span><span class="pln"> </span><span class="typ">AIMap_asysScript</span><span class="pun">(</span><span class="pln">url</span><span class="pun">,</span><span class="pln">callback</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L1"><code><span class="pln">    </span><span class="kwd">var</span><span class="pln"> script </span><span class="pun">=</span><span class="pln"> document</span><span class="pun">.</span><span class="pln">createElement</span><span class="pun">(</span><span class="str">"script"</span><span class="pun">);</span></code></li><li class="L2"><code><span class="pln">    script</span><span class="pun">.</span><span class="pln">type </span><span class="pun">=</span><span class="pln"> </span><span class="str">"text/javascript"</span><span class="pun">;</span></code></li><li class="L3"><code><span class="pln">    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">script</span><span class="pun">.</span><span class="pln">readyState</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="com">//IE </span></code></li><li class="L4"><code><span class="pln">        script</span><span class="pun">.</span><span class="pln">onreadystatechange </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L5"><code><span class="pln">            </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">script</span><span class="pun">.</span><span class="pln">readyState </span><span class="pun">==</span><span class="pln"> </span><span class="str">"loaded"</span><span class="pln"> </span><span class="pun">||</span><span class="pln"> script</span><span class="pun">.</span><span class="pln">readyState </span><span class="pun">==</span><span class="pln"> </span><span class="str">"complete"</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L6"><code><span class="pln">                script</span><span class="pun">.</span><span class="pln">onreadystatechange </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">;</span></code></li><li class="L7"><code><span class="pln">                callback</span><span class="pun">();</span></code></li><li class="L8"><code><span class="pln">            </span><span class="pun">}</span></code></li><li class="L9"><code><span class="pln">        </span><span class="pun">};</span></code></li><li class="L0"><code><span class="pln">    </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="com">//Others: Firefox, Safari, Chrome, and Opera</span></code></li><li class="L1"><code><span class="pln">        script</span><span class="pun">.</span><span class="pln">onload </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L2"><code><span class="pln">            callback</span><span class="pun">();</span></code></li><li class="L3"><code><span class="pln">        </span><span class="pun">};</span></code></li><li class="L4"><code><span class="pln">    </span><span class="pun">}</span></code></li><li class="L5"><code><span class="pln">    script</span><span class="pun">.</span><span class="pln">src </span><span class="pun">=</span><span class="pln"> url</span><span class="pun">+</span><span class="str">"?&amp;_="</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Date</span><span class="pun">()).</span><span class="pln">getTime</span><span class="pun">();</span></code></li><li class="L6"><code><span class="pln">    document</span><span class="pun">.</span><span class="pln">body</span><span class="pun">.</span><span class="pln">appendChild</span><span class="pun">(</span><span class="pln">script</span><span class="pun">);</span></code></li><li class="L7"><code><span class="pun">}</span></code></li></ol></pre>

<ul>
<li>大数组切割工具 <br>
<ul><li>功能说明：由于第三方调用GIS后台管理系统时，都是跨域请求，请求的参数太长会导致请求失败，应用场景：根据组织id数组在地图上显示标记点。</li>
<li>核心代码：</li></ul></li>
</ul>

<div class="md-section-divider"></div>

<pre class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code><span class="com">/**</span></code></li><li class="L1"><code><span class="com"> *跨域传参过长分割数组</span></code></li><li class="L2"><code><span class="com"> *oldArr：要处理的数组</span></code></li><li class="L3"><code><span class="com"> *maxLength：每次可传输的最大长度限制</span></code></li><li class="L4"><code><span class="com"> *方法返回新数组</span></code></li><li class="L5"><code><span class="com">**/</span></code></li><li class="L6"><code><span class="kwd">function</span><span class="pln"> </span><span class="typ">AIMap_splitArray</span><span class="pun">(</span><span class="pln">oldArr</span><span class="pun">,</span><span class="pln"> maxLength</span><span class="pun">){</span></code></li><li class="L7"><code><span class="pln">    </span><span class="kwd">var</span><span class="pln"> oldArr </span><span class="pun">=</span><span class="pln"> oldArr</span><span class="pun">.</span><span class="pln">slice</span><span class="pun">(</span><span class="lit">0</span><span class="pun">);</span></code></li><li class="L8"><code><span class="pln">    </span><span class="com">//每次可传输字符串的最大长度限制 </span></code></li><li class="L9"><code><span class="pln">    </span><span class="kwd">var</span><span class="pln"> MAX_LENGTH </span><span class="pun">=</span><span class="pln"> maxLength</span><span class="pun">||</span><span class="lit">255</span><span class="pun">;</span><span class="pln"> </span></code></li><li class="L0"><code><span class="pln">    </span><span class="com">// 建议每次传输的数组长度</span></code></li><li class="L1"><code><span class="pln">    </span><span class="kwd">var</span><span class="pln"> RECOMM_SINGLE_ARRAY_LENGTH </span><span class="pun">=</span><span class="pln"> </span><span class="lit">100</span><span class="pun">;</span></code></li><li class="L2"><code><span class="pln">    </span><span class="com">// 当建议传输长度仍过长时的递减值</span></code></li><li class="L3"><code><span class="pln">    </span><span class="kwd">var</span><span class="pln"> RECOMM_STEP_BACK </span><span class="pun">=</span><span class="pln"> </span><span class="lit">5</span><span class="pun">;</span></code></li><li class="L4"><code></code></li><li class="L5"><code><span class="pln">    </span><span class="com">// 拆分后的数组子集，每个子数组stringify后长度不超过指定的限制</span></code></li><li class="L6"><code><span class="pln">    </span><span class="kwd">var</span><span class="pln"> subArrs </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[];</span></code></li><li class="L7"><code></code></li><li class="L8"><code><span class="pln">    </span><span class="com">// if(JSON.stringify(oldArr).length &lt; MAX_LENGTH){//ie6需引入json2.js</span></code></li><li class="L9"><code><span class="pln">    </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">oldArr</span><span class="pun">.</span><span class="pln">join</span><span class="pun">(</span><span class="str">""</span><span class="pun">).</span><span class="pln">length </span><span class="pun">&lt;</span><span class="pln"> MAX_LENGTH</span><span class="pun">){</span></code></li><li class="L0"><code><span class="pln">        </span><span class="com">// 小于最大限制时直接发送</span></code></li><li class="L1"><code><span class="pln">        subArrs</span><span class="pun">.</span><span class="pln">push</span><span class="pun">(</span><span class="pln">oldArr</span><span class="pun">);</span></code></li><li class="L2"><code><span class="pln">    </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L3"><code><span class="pln">        </span><span class="com">// 对数组进行拆分</span></code></li><li class="L4"><code><span class="pln">        </span><span class="kwd">var</span><span class="pln"> remainArr </span><span class="pun">=</span><span class="pln"> oldArr</span><span class="pun">;</span></code></li><li class="L5"><code><span class="pln">        </span><span class="kwd">while</span><span class="pun">(</span><span class="pln">remainArr</span><span class="pun">.</span><span class="pln">length </span><span class="pun">&gt;</span><span class="pln"> </span><span class="lit">0</span><span class="pun">){</span></code></li><li class="L6"><code><span class="pln">            </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">var</span><span class="pln"> tryLength </span><span class="pun">=</span><span class="pln"> RECOMM_SINGLE_ARRAY_LENGTH</span><span class="pun">;</span><span class="pln"> tryLength </span><span class="pun">&gt;</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> tryLength </span><span class="pun">-=</span><span class="pln"> RECOMM_STEP_BACK</span><span class="pun">){</span></code></li><li class="L7"><code><span class="pln">                </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">tryLength </span><span class="pun">&gt;</span><span class="pln"> remainArr</span><span class="pun">.</span><span class="pln">length</span><span class="pun">){</span></code></li><li class="L8"><code><span class="pln">                    tryLength </span><span class="pun">=</span><span class="pln"> remainArr</span><span class="pun">.</span><span class="pln">length</span><span class="pun">;</span></code></li><li class="L9"><code><span class="pln">                </span><span class="pun">}</span></code></li><li class="L0"><code><span class="pln">                </span><span class="kwd">var</span><span class="pln"> subArr </span><span class="pun">=</span><span class="pln"> remainArr</span><span class="pun">.</span><span class="pln">slice</span><span class="pun">(</span><span class="lit">0</span><span class="pun">,</span><span class="pln"> tryLength</span><span class="pun">);</span></code></li><li class="L1"><code><span class="pln">                </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">subArr</span><span class="pun">.</span><span class="pln">join</span><span class="pun">(</span><span class="str">""</span><span class="pun">).</span><span class="pln">length </span><span class="pun">&lt;</span><span class="pln"> MAX_LENGTH</span><span class="pun">){</span></code></li><li class="L2"><code><span class="pln">                    remainArr</span><span class="pun">.</span><span class="pln">splice</span><span class="pun">(</span><span class="lit">0</span><span class="pun">,</span><span class="pln">tryLength</span><span class="pun">);</span></code></li><li class="L3"><code><span class="pln">                    subArrs</span><span class="pun">.</span><span class="pln">push</span><span class="pun">(</span><span class="pln">subArr</span><span class="pun">);</span></code></li><li class="L4"><code><span class="pln">                    </span><span class="kwd">break</span><span class="pun">;</span></code></li><li class="L5"><code><span class="pln">                </span><span class="pun">}</span></code></li><li class="L6"><code><span class="pln">            </span><span class="pun">}</span></code></li><li class="L7"><code><span class="pln">        </span><span class="pun">}</span></code></li><li class="L8"><code><span class="pln">    </span><span class="pun">}</span></code></li><li class="L9"><code><span class="pln">    </span><span class="kwd">return</span><span class="pln"> subArrs</span><span class="pun">;</span></code></li><li class="L0"><code><span class="pun">}</span></code></li></ol></pre>

<ul>
<li>根据标记点坐标获取在数组中的索引 <br>
<ul><li>功能说明：用于地图绘制时，判断新增的标记点是否需要自动吸附到父区域或者兄弟区域上。方法返回索引值。</li>
<li>核心代码：</li></ul></li>
</ul>

<div class="md-section-divider"></div>

<pre class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code><span class="com">/** </span></code></li><li class="L1"><code><span class="com">*返回数组索引 </span></code></li><li class="L2"><code><span class="com">*/</span><span class="pln"> </span></code></li><li class="L3"><code><span class="kwd">function</span><span class="pln"> </span><span class="typ">AIMap_getIndex</span><span class="pun">(</span><span class="pln">array</span><span class="pun">,</span><span class="pln"> val</span><span class="pun">){</span></code></li><li class="L4"><code><span class="pln">    </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">var</span><span class="pln"> i</span><span class="pun">=</span><span class="lit">0</span><span class="pun">,</span><span class="pln">leng</span><span class="pun">=</span><span class="pln">array</span><span class="pun">.</span><span class="pln">length</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">&lt;</span><span class="pln">leng</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++){</span></code></li><li class="L5"><code><span class="pln">        </span><span class="kwd">if</span><span class="pun">(</span><span class="typ">AIMap_judgeSame</span><span class="pun">(</span><span class="pln">array</span><span class="pun">[</span><span class="pln">i</span><span class="pun">],</span><span class="pln">val</span><span class="pun">)){</span></code></li><li class="L6"><code><span class="pln">            </span><span class="kwd">return</span><span class="pln"> i</span><span class="pun">;</span></code></li><li class="L7"><code><span class="pln">        </span><span class="pun">}</span></code></li><li class="L8"><code><span class="pln">    </span><span class="pun">}</span></code></li><li class="L9"><code><span class="pln">    </span><span class="kwd">return</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pun">;</span></code></li><li class="L0"><code><span class="pun">}</span></code></li><li class="L1"><code></code></li><li class="L2"><code><span class="com">/**</span></code></li><li class="L3"><code><span class="com">*判断是否为同一点</span></code></li><li class="L4"><code><span class="com">*相差500以内</span></code></li><li class="L5"><code><span class="com">**/</span></code></li><li class="L6"><code><span class="kwd">function</span><span class="pln"> </span><span class="typ">AIMap_judgeSame</span><span class="pun">(</span><span class="pln">array</span><span class="pun">,</span><span class="pln">array2</span><span class="pun">){</span></code></li><li class="L7"><code><span class="pln">    </span><span class="kwd">if</span><span class="pun">(</span><span class="typ">Math</span><span class="pun">.</span><span class="pln">abs</span><span class="pun">(</span><span class="pln">array</span><span class="pun">.</span><span class="pln">lng</span><span class="pun">*</span><span class="lit">1000000</span><span class="pun">-</span><span class="pln">array2</span><span class="pun">.</span><span class="pln">lng</span><span class="pun">*</span><span class="lit">1000000</span><span class="pun">)</span><span class="pln"> </span><span class="pun">&lt;</span><span class="pln"> </span><span class="lit">500</span><span class="pln"> </span><span class="pun">&amp;&amp;</span><span class="pln"> </span><span class="typ">Math</span><span class="pun">.</span><span class="pln">abs</span><span class="pun">(</span><span class="pln">array</span><span class="pun">.</span><span class="pln">lat</span><span class="pun">*</span><span class="lit">1000000</span><span class="pun">-</span><span class="pln">array2</span><span class="pun">.</span><span class="pln">lat</span><span class="pun">*</span><span class="lit">1000000</span><span class="pun">)</span><span class="pln"> </span><span class="pun">&lt;</span><span class="pln"> </span><span class="lit">500</span><span class="pun">)</span></code></li><li class="L8"><code><span class="pln">        </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">;</span></code></li><li class="L9"><code><span class="pln">    </span><span class="kwd">else</span></code></li><li class="L0"><code><span class="pln">        </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">;</span></code></li><li class="L1"><code><span class="pun">}</span></code></li></ol></pre>

<ul>
<li>base64转码工具 <br>
<ul><li>功能说明：由于安全问题考虑，需要将请求数据先行转码再通过ajax传给GIS后台系统。</li>
<li>核心代码：</li></ul></li>
</ul>

<div class="md-section-divider"></div>

<pre class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code><span class="kwd">function</span><span class="pln"> encodeBase64</span><span class="pun">(</span><span class="pln">str</span><span class="pun">){</span></code></li><li class="L1"><code><span class="pln">    </span><span class="kwd">try</span><span class="pun">{</span></code></li><li class="L2"><code><span class="pln">        </span><span class="kwd">var</span><span class="pln"> wordArray </span><span class="pun">=</span><span class="pln"> </span><span class="typ">CryptoJS</span><span class="pun">.</span><span class="pln">enc</span><span class="pun">.</span><span class="typ">Utf8</span><span class="pun">.</span><span class="pln">parse</span><span class="pun">(</span><span class="pln">str</span><span class="pun">);</span></code></li><li class="L3"><code><span class="pln">        </span><span class="kwd">var</span><span class="pln"> base64Json</span><span class="pun">=</span><span class="pln"> </span><span class="typ">CryptoJS</span><span class="pun">.</span><span class="pln">enc</span><span class="pun">.</span><span class="typ">Base64</span><span class="pun">.</span><span class="pln">stringify</span><span class="pun">(</span><span class="pln">wordArray</span><span class="pun">);</span></code></li><li class="L4"><code><span class="pln">        </span><span class="kwd">return</span><span class="pln"> base64Json</span><span class="pun">;</span></code></li><li class="L5"><code><span class="pln">    </span><span class="pun">}</span><span class="kwd">catch</span><span class="pun">(</span><span class="pln">e</span><span class="pun">){</span></code></li><li class="L6"><code><span class="pln">        </span><span class="com">//console.log('CryptoJS is not include.');</span></code></li><li class="L7"><code><span class="pln">    </span><span class="pun">}</span></code></li><li class="L8"><code><span class="pln">    </span><span class="kwd">return</span><span class="pln"> str</span><span class="pun">;</span></code></li><li class="L9"><code><span class="pun">}</span></code></li></ol></pre>
</body>
</html>