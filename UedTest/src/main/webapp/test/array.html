<!DOCTYPE html>
<html>
<head>
<link rel="shortcut icon" href="zw.ico">
<meta http-equiv="Content-Type" content="text/html;charset=utf-8">
<title>testDemo</title>
<link rel="stylesheet" type="text/css" href="alice.css">
<script src="jquery.js" type="text/javascript"></script>
<style type="text/css">
html,body{
	width: 1200px;
	margin: 0 auto;
	background-color: #f0f0f0;
	font-size: 12px;
}
body, div, dl, dt, dd, ul, ol, li,
h1, h2, h3, h4, h5, h6, pre, code,
form, fieldset, legend, input, button,
textarea, p, blockquote, th, td {
    margin: 0;
    padding: 0;
}
</style>
</head>
<body>

<div>
	
</div>

<script type="text/javascript">
$(function(){
	var json = {"rtnMsg": "调用成功", "retInfo": [{"destid": "804300,", "startdate": "2015-04-22 09:16:21", "destinfo": "王晓飞", "enddate": "2015-05-22 15:41:38", "msg": [{"content": "您好！昨天下午没有参加会议的老师，请问一下昨日下午的会议内容，并按会议上的布置进行整理。投影机电子白板，打扫干净。下午教体局到我校检查（另外课间时间让学生文明玩耍，不要追逐打闹，注意安全，学校教师要严查）--来自：王晓飞老师", "filepath": "http://mfile.xxt.cn/", "msgid": 539650982, "msgtype": "cc", "createdate": "2015-04-22 09:16:21", "filename": "", "filetype": 0, "destusertype": 0, "filetimelong": null, "msgsendtype": 2 }, {"content": "您好！全体在编教师第二节下课到会议室开会，所有人必须参加，涉及个人利益，请迅速到会。--来自：王晓飞老师", "filepath": "http://mfile.xxt.cn/", "msgid": 539658478, "msgtype": "cc", "createdate": "2015-04-22 09:36:12", "filename": "", "filetype": 0, "destusertype": 0, "filetimelong": null, "msgsendtype": 2 } ] }, {"destid": "689746,", "startdate": "2015-04-20 07:46:27", "destinfo": "刘淑娜", "enddate": "2015-05-21 19:28:21", "msg": [{"content": "今天上午改卷： 二语：轶利 冯丹丹   二数：巧利                一数：乔飞飞  刘缓缓， 没有改卷任务的正常上课。【办公室】", "filepath": "http://mfile.xxt.cn/", "msgid": 538731824, "msgtype": "cc", "createdate": "2015-04-20 07:46:27", "filename": "", "filetype": 0, "destusertype": 0, "filetimelong": null, "msgsendtype": 2 }, {"content": "中心校检查。注意卫生，办公室卫生【办公室】", "filepath": "http://mfile.xxt.cn/", "msgid": 544956266, "msgtype": "cc", "createdate": "2015-05-04 10:44:31", "filename": "", "filetype": 0, "destusertype": 0, "filetimelong": null, "msgsendtype": 2 }, {"content": "上课的老师注意教室卫生，中心校检查【办公室】", "filepath": "http://mfile.xxt.cn/", "msgid": 544956908, "msgtype": "cc", "createdate": "2015-05-04 10:45:12", "filename": "", "filetype": 0, "destusertype": 0, "filetimelong": null, "msgsendtype": 2 } ] }, {"destid": "3765427,", "startdate": "2015-04-20 13:20:59", "destinfo": "周淑娟", "enddate": "2015-05-20 10:57:37", "msg": [{"content": "下午参加评卷的老师，抓紧时间到相应评卷室，不参加评卷的老师上好课，注意班级卫生、楼道卫生、卫生区卫生。【周淑娟】", "filepath": "http://mfile.xxt.cn/", "msgid": 538857356, "msgtype": "cc", "createdate": "2015-04-20 13:20:59", "filename": "", "filetype": 0, "destusertype": 0, "filetimelong": null, "msgsendtype": 2 } ] }, {"destid": "1388504,", "startdate": "2015-04-24 15:50:00", "destinfo": "郭灿阳,孟朝阳,马可豪...", "enddate": "2015-05-18 11:25:15", "msg": [{"content": "家长你好！周末作业写单元五词语盘点和日积月累各写两遍。希望家长督促孩子的学习。让孩子看看四大名著。祝你周末愉快！【崔苗芳老师】", "filepath": "http://mfile.xxt.cn/", "msgid": 540669820, "msgtype": "gg", "createdate": "2015-04-24 15:50:00", "filename": "", "filetype": 0, "destusertype": "2", "filetimelong": null, "msgsendtype": 1 }, {"content": "家长您好！周末在给孩子改善生活的同时，请抽出时间多陪陪孩子，和他们谈谈心，引导他们如何正确处理学习生活中遇到的各种问题，教会他们自己合理安排利用好时间，督促孩子认真完成各科作业，鼓励他们闲暇时多参加一些有意义的活动，而不是长时间看电视或玩游戏。祝周末愉快！【崔苗芳老师】", "filepath": "http://mfile.xxt.cn/", "msgid": 540670116, "msgtype": "gg", "createdate": "2015-04-25 08:00:00", "filename": "", "filetype": 0, "destusertype": "2", "filetimelong": null, "msgsendtype": 2 }, {"content": "家长您好！因为明天是五一国家法定节假日，请于今天下午4：20来校接孩子。周一早上7：30前到校。谢谢您的配合。【崔苗芳老师】", "filepath": "http://mfile.xxt.cn/", "msgid": 543470318, "msgtype": "gg", "createdate": "2015-04-30 10:20:32", "filename": "", "filetype": 0, "destusertype": "2", "filetimelong": null, "msgsendtype": 2 }, {"content": "家长您好！假期语文作业1、生字表二的生字注拼音、组一个词各写一遍。2、写出考后反思。希望家长督促孩子的学习。【崔苗芳老师】", "filepath": "http://mfile.xxt.cn/", "msgid": 543547342, "msgtype": "gg", "createdate": "2015-04-30 16:40:00", "filename": "", "filetype": 0, "destusertype": "2", "filetimelong": null, "msgsendtype": 1 } ] }, {"destid": "1202222,", "startdate": "2015-05-18 10:24:10", "destinfo": "刘如笑", "enddate": "2015-05-18 10:24:10", "msg": [{"content": "请上周填写课堂教学观察量表的同事抓紧时间把表填好交过来，立等上交！【刘如笑老师】", "filepath": "http://mfile.xxt.cn/", "msgid": 550538568, "msgtype": "cc", "createdate": "2015-05-18 10:24:10", "filename": "", "filetype": 0, "destusertype": 0, "filetimelong": null, "msgsendtype": 2 } ] }, {"destid": "3097317,", "startdate": "2015-04-24 07:09:26", "destinfo": "刘婷婷", "enddate": "2015-05-12 09:39:05", "msg": [{"content": "各级老师，今天在教室一定要强调安全问题，文明玩耍，尤其不要去河边玩耍，昨天发现有学生去捉鱼逮螃蟹。【刘婷婷老师】", "filepath": "http://mfile.xxt.cn/", "msgid": 540477128, "msgtype": "cc", "createdate": "2015-04-24 07:09:26", "filename": "", "filetype": 0, "destusertype": 0, "filetimelong": null, "msgsendtype": 2 }, {"content": "各位同事打扰了，如您见到一个绿色U盘，请与胡巧丽老师联系。谢谢。【刘婷婷老师】", "filepath": "http://mfile.xxt.cn/", "msgid": 547193024, "msgtype": "cc", "createdate": "2015-05-08 12:25:59", "filename": "", "filetype": 0, "destusertype": 0, "filetimelong": null, "msgsendtype": 2 }, {"content": "各位老师好，课间操请及时到位，各班主任要求学生注意卫生，保洁员做好保洁工作！谢谢！【刘婷婷老师】", "filepath": "http://mfile.xxt.cn/", "msgid": 548203938, "msgtype": "cc", "createdate": "2015-05-12 09:25:03", "filename": "", "filetype": 0, "destusertype": 0, "filetimelong": null, "msgsendtype": 2 }, {"content": "各位老师好，课间操请及时到位，各班主任要求学生注意卫生，保洁员做好保洁工作！谢谢！【刘婷婷老师】【刘婷婷老师】", "filepath": "http://mfile.xxt.cn/", "msgid": 548205612, "msgtype": "cc", "createdate": "2015-05-12 09:28:56", "filename": "", "filetype": 0, "destusertype": 0, "filetimelong": null, "msgsendtype": 2 }, {"content": "各位老师好，课间操请及时到位，各班主任要求学生注意卫生，保洁员做好保洁工作！谢谢！【刘婷婷老师】【刘婷婷老师】", "filepath": "http://mfile.xxt.cn/", "msgid": 548210334, "msgtype": "cc", "createdate": "2015-05-12 09:35:39", "filename": "", "filetype": 0, "destusertype": 0, "filetimelong": null, "msgsendtype": 2 } ] }, {"destid": "5340259,", "startdate": "2015-04-30 14:05:01", "destinfo": "孙银焕", "enddate": "2015-04-30 14:05:01", "msg": [{"content": "老师们好！今天下午两节课后学生离校，假期三天，班主任老师在教室给孩子们讲好安全。【办公室】", "filepath": "http://mfile.xxt.cn/", "msgid": 543776424, "msgtype": "cc", "createdate": "2015-04-30 14:05:01", "filename": "", "filetype": 0, "destusertype": 0, "filetimelong": null, "msgsendtype": 2 } ] }, {"destid": "776389,", "startdate": "2015-04-29 15:26:03", "destinfo": "范志乐", "enddate": "2015-04-29 16:30:31", "msg": [{"content": "下午好！请现在到后勤处领取水笔芯。如缺红笔芯也一并领取！【范志乐老师】", "filepath": "http://mfile.xxt.cn/", "msgid": 542817700, "msgtype": "cc", "createdate": "2015-04-29 15:26:03", "filename": "", "filetype": 0, "destusertype": 0, "filetimelong": null, "msgsendtype": 2 }, {"content": "下午好！各办公室的饮水机、窗户玻璃和窗纱有问题的请于明天上午八点半报于后勤处；另外各班主任查看教室玻璃和窗框，有问题的，写清楚班级、问题是什么（尽量具体），可由班长明天上午八点半交于后勤处，请务必按时上交！【范志乐老师】", "filepath": "http://mfile.xxt.cn/", "msgid": 542903188, "msgtype": "cc", "createdate": "2015-04-29 16:30:31", "filename": "", "filetype": 0, "destusertype": 0, "filetimelong": null, "msgsendtype": 2 } ] } ], "rtnCode": "1"};
		
	var retInfo = json.retInfo;
	var destidArray = [];//装载新的数据
	var userId = "zz";
	
	for(var key in retInfo){
		var msgArr = retInfo[key].msg;
		for(var i=0, length=msgArr.length; i<length; i++){
			var arr = {};
			arr.userId = userId;
			arr.destid = retInfo[key].destid;
			arr.destinfo = retInfo[key].destinfo;
			arr.msg = msgArr[i];
			arr.createdate = msgArr[i].createdate;
			destidArray.push(arr);
		}
	}
	
	console.log(JSON.stringify(destidArray));

	var currentDestid = '1388504,';
	for(var k=0, klength=retInfo.length; k<klength; k++){
		if(currentDestid == retInfo[k].destid){
			//追加数据，注意去除msgsendtype=1的数据
			var cMsg = retInfo[k].msg;
			var newCMsg = [];
			// console.log(JSON.stringify(cMsg));
			for(var n=0, nLength=cMsg.length; n<nLength; n++){
				if(cMsg[n].msgsendtype == '2'){
					newCMsg.push(cMsg[n]);
				}
			}
			// console.log(JSON.stringify(newCMsg));
		}
	}
	console.log(dateToStr(new Date(1432541394198)))
});

// 格式化日期时间字符串，格式为"YYYY-MM-DD HH:MM:SS"
function dateToStr(d){
	return (d.getFullYear()+"-"+ultZeroize(d.getMonth()+1)+"-"+ultZeroize(d.getDate())+" "+ultZeroize(d.getHours())+":"+ultZeroize(d.getMinutes())+":"+ultZeroize(d.getSeconds()));
};
/**
 * zeroize value with length(default is 2).
 * @param {Object} v
 * @param {Number} l
 * @return {String} 
 */
function ultZeroize(v,l){
	var z="";
	l=l||2;
	v=String(v);
	for(var i=0;i<l-v.length;i++){
		z+="0";
	}
	return z+v;
}
</script>
</body>
</html>