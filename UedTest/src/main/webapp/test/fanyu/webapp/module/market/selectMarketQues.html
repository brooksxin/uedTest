<!DOCTYPE html>
<html>
<head>
<title>创建外呼营销任务step3_选择问卷</title>
<#include "../../tpl/res_css.tpl" />
</head>
<body>
<div class="formItem">
    <div class="titleArea bd-bottom fn-clear">
        <a href="javascript:history.go(-1);" class="ui-getBackJ fn-left"></a><h2 class="ui-textIndentStyle fn-left">创建新项目</h2>
    </div>


   <div class="flowSteps_six">
        <!--第二步样式改为current_2-->
        <ul class="current_3 fn-clear">
            <li class="FirstStep">
                <a href="javascript:;">基本信息</a>
            </li>
            <li class="SecondStep">
                <a href="javascript:;">选择商品</a>
            </li>
            <li class="ThirdStep">
                <a href="javascript:;">添加问卷</a>
            </li>
            <li class="FourStep">
                <a href="javascript:;">目标客户</a>
            </li>
            <li class="FiveStep">
                <a href="javascript:;">执行团队</a>
            </li>
        </ul>
    </div>

	<div class="record-search-cate" style="margin-top:30px;">
	<form class="record-search-form record-search-min record-search-form-border" id="J_formSearch" name="J_formSearch" >
      <table class="search_table" width="100%">
          <tbody>
          
              <tr>
                  <td width="80"><label class="description">问卷编号</label></td>
                  <td>
                      <input name="QNR_ID" class="inputWidth inputText" type="text" maxlength="255" value=""/>
                  </td>
                  <td width="80"><label class="description">问卷名称</label>
                   
                  </td>
                  <td>
                      <input name="QNR_NM" class="inputWidth inputText" type="text" maxlength="255" value=""/>
						<!-- <input name="mcdsUnitTypeCd" class="inputWidth inputText" type="text" maxlength="255" value="02" style="display:none"/> -->
                  </td>
                   <td width="80"><label class="description">发布人</label>
                   
                  </td>
                  <td>
                     <div id="UserID">
									<select class="inputWidth element text" id="OP_STAFF_ID"
										name="CRT_USER_ID">
										<option></option>
									</select>
								</div>
                  </td>
                 <!--  <td width="80"><label class="description">商家</label></td>
                  <td>
                   <select class="inputSelect" style="width:100px;">
                      <option>全部</option>
                   </select>
                  </td>
                  <td><div class="table_select"><input type="checkbox" /></div></td>
                  <td>
                       是否促销
                  </td>   -->
                  <td width="100">
				       <div class="normalBtnArea w82">
                            <a class="searchBtn" href="javascript:;" id="query_btn"  ><i></i>查询</a>
                        </div>
				  </td>
              </tr>
             
          </tbody>
      </table>
       </form>
</div>

<div class="tablewidth mg_t_10" style="margin-top:15px;">
                <table class="ui-record-table table_radius table-bordered table-striped"  >
                    <thead>
                        <tr>
                            <th width="25"></th>
                            <th width="80">问卷编号</th>
                            <th>问卷名称</th>
                            <th width="80">问卷类型</th>
                            <th width="80">发布人</th>
                            <th width="80">发布时间</th>
                        </tr>
                     </thead>
                     <tbody id="J_tabletpl">
                        
                    </tbody>
                </table>
</div>
          
              <!--翻页及功能按钮区域开始-->
    <DIV class="amount-bottom">
        <table width="100%" border="0" cellspacing="0" cellpadding="0" class="gridBottom">
          <tr>
            <td>
                <DIV class="fn-clear action-other  action-other-show ">
                        <DIV id=Pagination class="page pagination fn-right"> </DIV>
                        <DIV class="fn-right fn-pt5 fn-pr10"></DIV>
                </DIV></td>
          </tr>
        </table>
    </DIV>	

    </div>






    <div class="formBtnArea bd-top">
        <table width="100%">
            <tr>
                <td>
                    <div class="normalBtnArea">
                        <a class="normalBtn BGblue largeBtn" href="javascript:;" id="J_button_add">确定</a>
                        <a class="normalBtn BGgray largeBtn" href="#" id="Return">取消</a>
                    </div>
                </td>
            </tr>
        </table>
    </div>





<script id="T_tabletpl" type="text/x-handlebars-template">
    {{#if beans}}
    {{#each beans}}
       <tr>
                            <td><div class="table_select">
                             <input name="myRadio" data-unitid="{{QNR_ID}}" type="radio" onclick="selectProd(this)"/><input class="dataListNo" value="{{QNR_ID}}" type="hidden"/>
                            </div></td>
                            <td>{{QNR_ID}}</td>
                            <td><div class="gridRowBtn"><a class="item-text" href="javascript:;">{{QNR_NM}}</a>
                            <input class="dataListNM" value="{{QNR_NM}}" type="hidden"/>
                             
                            </div></td>
                            <td>{{QNR_TYPE_CD}}</td>
							<td>{{OP_STAFF_ID}}</td>
                            <td>{{OP_TIME}}</td>
                        </tr>
    {{/each}}
    {{else}}
        <tr class="noData">
            <td colspan="6" class="fn-center">对不起，暂无数据</td>
        </tr>
    {{/if}}
</script>

<#include "../../tpl/res_js.tpl" />
 
<script type="text/javascript">
srvMap.add('allUser','query.json','front/sh/user!userinfo?uid=u005');
srvMap.add('selectSingleProd','market/selectSingleProd.json','front/sh/questionaire!index?uid=qnrwq018');
//srvMap.add('bindingMarketCmpgnWithMcds','selectSingleProd.json','front/sh/market!index?uid=mwq002');
srvMap.add('update' , 'update.json','front/sh/market!index?uid=mgl003');//绑定问卷
srvMap.add('query','update.json','front/sh/market!index?uid=mgl005');//根据营销活动查询关联问卷
//srvMap.add('insert' , 'query.json','front/sh/market!index?uid=mwq002');//绑定营销活动和商品
//srvMap.add('query' , 'query.json','front/sh/market!index?uid=mwq003');//根据活动ID查询所有绑定的商品
//srvMap.add('delete' , 'query.json','front/sh/market!index?uid=mwq005');//解绑活动和商品的关系
var id=Util.browser.getParameter("id");
var goodId=Util.browser.getParameter("goodId");
var cmd={"CMPGN_ID":id};
var _qid;
var _qnm;

//页面加载完成时执行
$(function () {
  	 
    //获取初始化数据
    execPage();

    //点击查询重新获取数据
     $('#query_btn').bind('click',function(){
        execPage();
    }); 
    //点击表格选中行
     $("#J_tabletpl").bind("click",function(event){
        var _target=event.target;
        var _currentLine=$(_target).parent("tr");
        _currentLine.addClass("active");
        _currentLine.siblings().removeClass("active");
        _currentLine.find("input[type=radio]").attr("checked",true);
        _currentLine.find("td").css({"background":"#E0EDFA"});
        _currentLine.siblings().find("td").css({"background":""});
    });


    //获取选中行的商品pid
    $("#J_button_add").bind("click",function(event){
        //若没有数据，禁止a标签的点击行为
        _qid=$("#J_tabletpl tr.active input.dataListNo").val();
        _qnm=$("#J_tabletpl tr.active input.dataListNM").val();
        if(typeof _qid ==="undefined"){
            Util.dialog.tips("请选择一个问卷!")
        }else{
        	window.location.href="addGoods.html?id="+id+"&qnm="+_qnm+"&qid="+_qid+"&goodId="+goodId;
        }
        
        
    }); 
    
    
  
  $("#Return").bind("click",function(){
	  window.location.href="addGoods.html?id="+id+"&goodId="+goodId;
  });
  
  var dept = {
	  		"DEPT_ID": userInfo.bean.deptId 
	  }
	//加载创建工号
	  $("#UserID").NiceSelect({
	     	url:srvMap.get('allUser'),
	         datas : dept,
	         id : "CRT_USER_ID",
	         name : "OP_STAFF_ID",
	         all:"请选择",
	         key:"USER_ID",
	         value:"PTY_NO"
	   });
  
});

function pageback(){
        Util.ajax.postJson(srvMap.get('query'),cmd,function(json,status){
            if(status){
                if(json.beans.length != "0"){
                    var QNR_ID = json.beans[0].QNR_ID;
                     $("#J_tabletpl tr").each(function(index,item){
                        
                        var _self = $(this).find("td:eq(0) input[type='radio']")
                        var unitid = _self.data("unitid");

                        if(unitid == QNR_ID){  
                            _self.attr("checked",true);
                            _self.parent().parent().parent().addClass("active").siblings().removeClass("active");
                        }
                    });
                }
                
            }
        });
}

function selectProd(obj){
    $(obj).parent().parent().parent().addClass("active").siblings().removeClass("active");
}

function execPage(){
    var _G_params = {
        url : srvMap.get('selectSingleProd'),
        searchformId :"J_formSearch",
        items_per_page : 10,   //每页数 @param : limit
        page_index : 0, //当前页 @param : start
        pagination : "Pagination", //分页标识id
        tabletpl : "T_tabletpl", //表格模板
        tablewrap :"J_tabletpl", //表格容器
        pageCallback: pageback
    };
    var str= $("#"+_G_params.searchformId).serialize();
    Util.pagination(_G_params.page_index ,true,_G_params,str);
}
</script>
</body>
</html>




