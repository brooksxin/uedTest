<!DOCTYPE html>
<html>
<head>
<title>10085系统</title>
<#include "../../tpl/res_css.tpl" />
</head>
<body>

                <div class="breadcrumb"></div>
                <div class="cmxform" >
                   <form class="record-search-form record-search-min record-search-form-border" id="J_formSearch" name="J_formSearch" >
                      <div class="record-search-cate">
<table class="search_table" cellpadding="0" cellspacing="0" border="0" width="100%">
	<tr>
		<td width="90"><label class="description">开始时间</label></td>
		<td><input id="startDate" name= "startDate" class="inputWidth  element text Wdate" type="text" onclick="WdatePicker({startDate:'%y-%M-01 00:00:00',dateFmt:'yyyy-MM-dd HH:mm:ss',alwaysUseStartDate:true,minDate:'#F{\'2010-01-01 00:00:00\'}',maxDate:'#F{$dp.$D(\'endDate\')}'})" /></td>
		<td><label class="description">结束时间</label></td>
		<td><input id="endDate" name="endDate" class="inputWidth  element text Wdate" type="text" onclick="WdatePicker({startDate:'%y-%M-01 00:00:00',dateFmt:'yyyy-MM-dd HH:mm:ss',alwaysUseStartDate:true,minDate:'#F{$dp.$D(\'startDate\',{d:1})||\'2010-01-01 23:59:59\'}'})" /></td>
		<td width="100"><label class="description"> 客户来电号码 </label></td>
		<td width="100"><input id = "callingNum"  name = "callingNum" class="inputWidth inputText" type="text" maxlength="255" value="" /></td>
		<td width=""><div class="normalBtnArea w82"> <a class="searchBtn" href="javascript:;" id="J_search"> <i> </i> 查询 </a> </div></td>
	</tr>
	<tbody id="J_searchMore" class="searchMore">
		<tr>
			<td><label class="description"> 处理人 </label></td>
			<td><input id="staffName" name = "staffName" class="inputWidth inputText" type="text" maxlength="255" value="" /></td>
			<td width="100"><label class="description"> 工号 </label></td>
			<td><input id="userCode" name = "userCode" class="inputWidth inputText" type="text" maxlength="255" value="" /></td>

			<td><label class="description"> 订单编号 </label></td>
			<td><input id="orderId" name = "orderId" class="inputWidth inputText" type="text" maxlength="255" value="" /></td>
			<td></td>
		</tr>
		<tr>
		    <td><label class="description"> 运单号 </label></td>
			<td><input id="ehsBlId" name = "ehsBlId" type="text" maxlength="255" value="" class="inputWidth"/></td>
			<td><label class="description"> 物流状态 </label></td>
			<td><div id="J_ehsState">
					<select class="inputWidth inputSelect" id="ehsSts" name = "ehsSts" >
						<option> </option>
					</select>
				</div></td>
			<td><label class="description"> IMEI </label></td>
			<td><input id="imie" name = "imie"  class="inputWidth inputText" type="text" maxlength="255" value="" /></td>
			
			<td></td>
		</tr>
		<tr>
			<td><label class="description"> 客户归属地 </label></td>
			<td><input class="inputWidth inputText" type="text" maxlength="255" value="" /></td>
			<td><label class="description"> 活动信息 </label></td>
			<td><div id="J_campgn">
					<select class="inputWidth inputSelect"  id="cmpgnId" name = "cmpgnId">
					</select>
				</div></td>
			<td><label class="description" id="paymnType"> 支付方式 </label></td>
			<td><div id="J_paymnType">
					<select class="inputWidth inputSelect" id="paymnType" name = "paymnType" >
					</select>
				</div></td>
				<td></td>
		</tr>
		<tr>
			<td>
			<label class="description">商品名称</label></td>
			<td><input id="mcdsNm" name = "mcdsNm" class="inputWidth inputText" type="text" maxlength="255" value="" /></td>
			<td><label class="description"> 客户姓名 </label></td>
			<td><input id="custNm" name = "custNm" class="inputWidth inputText" type="text" maxlength="255" value="" /></td>
			<td><label class="description" id="odrPayStsCd"> 支付状态 </label></td>
			<td><div id="J_orderPayStatus">
					<select class="inputWidth inputSelect" id="odrPayStsCd" name = "odrPayStsCd">
					</select>
				</div>
			</td>			
			<td></td>
		</tr>
		<tr>
			<td><label class="description" id="chnlId"> 渠道 </label></td>
			<td><div id="J_chnl">
				<select class="inputWidth inputSelect" id="chnlId" name = "chnlId">
				</select>
			</div></td>
			<td><label class="description">O2O源渠道订单号</label></td>
			<td><input id = "coopPrnrOdrNo"  name = "coopPrnrOdrNo" class="inputWidth inputText" type="text" maxlength="255" value="" /></td>
			<td></td>
			<td></td>
			<td></td>
		</tr>
	</tbody>
</table>
                        </div>
                        <div class="seeMoreFilter"><a href="#" class="down"></a></div>
                    </form>
                </div>
                         
                <div class="listTopBtn">
                	<table width="100%" border="0" cellspacing="0" cellpadding="0">
                     <tr>
                        <td width=""></td>
                        <td><div class="normalBtnArea ft-right"><a class="normalBtn BGblue" href="#" id="J_archive">全部归档</a>
                        	<a class="normalBtn BGblue" href="#"  id="exportFile">已取消订单导出</a>
                        </div></td>
                      </tr>
                    </table>
                </div>
                <div class="tablewidth mg_t_10">
            		<table class="ui-record-table table_radius table-bordered table-striped"  >
            			<thead>
            				<tr>
            					<th width="25"></th>
            					<th width="60">订单编号</th>
            					<th width="">商品名称</th>
            					<th width="40">金额</th>
            					<th width="50">客户名</th>
            					<th width="80">客户来电号码</th>
            					<th width="80">下单时间</th>
            					<th width="80">渠道</th>
            					<th width="60">订单状态</th>
            					<th width="60">支付状态</th>
                                <th width="120">操作</th>
            				</tr>
                         </thead>
                         <tbody id="J_tabletpl"></tbody>
            		</table>
                </div>
                <!--翻页及功能按钮区域开始-->
                <DIV class="amount-bottom">
                    <table width="100%" border="0" cellspacing="0" cellpadding="0" class="gridBottom">
                      <tr>
                        <td width="60">
                            <input type="checkbox" class="selectAll" id="selectAll" /> <label for="selectAll">全选</label> 
                        </td>
                        <td>
                        </td>
                        <td width="50%">
                            <DIV class="fn-clear action-other  action-other-show ">
                                    <DIV id="Pagination" class="page pagination fn-right"></DIV>
                                    <DIV class="fn-right fn-pt5 fn-pr10"></DIV>
                            </DIV></td>
                      </tr>
                    </table>
                </DIV>

    <script id="T_tabletpl" type="text/x-handlebars-template">
    {{#if beans}}
        {{#each beans}}
            <tr>
                <td><div class="table_select"><input type="checkbox" value="{{odrId}}" /></div></td>
                <td>{{odrId}}</td>
                <td>{{mcdsUnitNm}}</td>
                <td><div class="gridNum">{{odrOrigAmt}}</div></td>
                <td>{{custName}}</td>
                <td>{{custResvTelNum}}</td>
                <td>{{crtTime}}</td>
				<td>{{chnlNm}}</td>
 				<td>{{odrStsNm}}</td>
 				<td>{{chgpyFlagNm}}</td>
                <td>
                    <div class="gridRowBtn">
                        <a class="item-text" href="javascript:;" onclick="exportForm('{{odrId}}')">查看</a>
                    </div>
                </td>
            </tr>
        {{/each}}
    {{else}}
      	<tr>
		<td colspan="9">
			<div class="ui-tips-box tipsBox">
				<div class="ui-icon-noData"></div>
				<div class="ui-tips-text">暂无数据记录！</div>
			</div>
		</td>
	</tr>
    {{/if}}
    </script>
<#include "../../tpl/res_js.tpl" />
<script type="text/javascript">
//页面加载完开始执行
/*
    服务配置
    param1: 服务名
    param2: 假数据路径
    param3: 后台服务路径
*/
srvMap.add('queryCancelOrderList', 'noPayPhoneBuy.json','front/sh/order!queryCancelOrderList?uid=o001');//查询服务
srvMap.add('archiveOrder', 'orderDetail.json','front/sh/order!archiveOrder?uid=o001');//查询服务
srvMap.add('allPayMode', 'allPayMode.json','front/sh/common!execute?uid=c002');//查询所有支付方式
srvMap.add('allEhsState', 'allSendMode.json','front/sh/common!execute?uid=c004');//查询物流状态
srvMap.add('allCampgn', 'allCampgn.json','front/sh/market!index?uid=my009');//查询所有活动
srvMap.add('allChnlId', 'allChnlId.json','front/sh/user!getChnl?uid=u001');//查询物流状态

var G_params = {
    url : srvMap.get('queryCancelOrderList'),
    items_per_page : 10 ,   // 每页数     @param : limit
    page_index : 0 , //当前页  @param : start
    pagination : "Pagination" , //分页id
    searchformId : "J_formSearch", //搜索表单的id
    tabletpl : "T_tabletpl", //表格模板
    tablewrap : "J_tabletpl" //表格容器
};
//全选checkbox
$('#selectAll').change(function() {
	var ck=this.checked;
	$("#J_tabletpl input[type='checkbox']").each(function(i,ele){
		this.checked=ck;
	});
});
//页面加载完开始执行
$(function () {
    //展开更多查询
    $("#J_toggleSearch").toggle(
        function(){$("#JS_filterMore").show();$("#J_toggleSearch").removeClass("down").addClass("up");},
        function(){$("#JS_filterMore").hide();$("#J_toggleSearch").removeClass("up").addClass("down");}
    );


    //动态加载支付方式
    $("#J_paymnType").NiceSelect({
          url:srvMap.get('allPayMode'),
          data:"",
          id:"paymnType",
          name:"paymnType",
          all:"请选择",
          key:"VAL",
          value:"NAME"
    });
    
    //动态加载物流状态
     $("#J_ehsState").NiceSelect({
        	url:srvMap.get('allEhsState'),
            datas : "cmnCd=CMD_0000000017",
            id : "ehsSts",
            name : "ehsSts",
            all:"请选择",
            key:"VAL",
            value:"NAME"
      });
    //动态支付状态
     $("#J_orderPayStatus").NiceSelect({
        	url:srvMap.get('allEhsState'),
            datas : "cmnCd=CMD_0000000004",
            id : "odrPayStsCd",
            name : "odrPayStsCd",
            all:"请选择",
            key:"VAL",
            value:"NAME"
      });
     //动态活动信息
     $("#J_campgn").NiceSelect({
        	url:srvMap.get('allCampgn'),
            datas : "",
            id : "cmpgnId",
            name : "cmpgnId",
            all:"请选择",
            key:"CMPGN_ID",
            value:"CMPGN_NM"
      });
     $("#J_chnl").NiceSelect({
    	  	url:srvMap.get('allChnlId'),
    	      datas : "",
    	      id : "chnlId",
    	      name : "chnlId",
    	      all:"请选择",
    	      key:"CHNL_ID",
    	      value:"PTY_NM"
     });

    $('#J_search').bind('click',function(){
        var str = $("#"+G_params.searchformId).serialize(); //把form序列化
        //分页获取数据
        Util.pagination(0, true , G_params , str );
    });
    $('#J_search').trigger("click");

    $('#J_archive').bind('click',function(){
    	if(confirm("您确定要归档已选择的全部订单吗?")){
        var $boxes =  $('#J_tabletpl').find('input[type=checkbox]:checked');
        var idStr = '';
        $.each($boxes, function(p0, p1, p3) {
        	idStr += $(p1).val()+',';
        });
       	idStr = "odrId="+ idStr;
      	//不分页获取数据
        Util.ajax.postJsonSync(srvMap.get('archiveOrder'),idStr,function(json,status){
             if (status) {
                 alert("归档完成，请在“全部归档订单”中查看。");
             }else{
                 alert(json.returnMessage||'归档失败，请重试！');
             }
        })
        $('#J_search').trigger("click");
    	}
    	
    });
});

function exportForm(brandId){
    window.location.href = "cancelOrderDetail.html?brandId="+brandId;
}
function cancelOrder(brandId){
    alert(brandId);
}
function call(brandId){
	alert(brandId);
}

//订单导出
$('#exportFile').bind('click',function(){
	 var str = $("#"+G_params.searchformId).serialize(); //把form序列化
     window.location.href="../../front/sh/common!exportWebExcel?uid=c006&"+str;
 
});
</script>
</body>
</html>